var globals={};'undefined'!=typeof window&&(globals.window=window),'undefined'!=typeof document&&(globals.document=document);let compatibilityModeData_,uniqueIdCounter_=1;const UID_PROPERTY='core_'+(1000000000*Math.random()>>>0);function abstractMethod(){throw Error('Unimplemented abstract method')}function collectSuperClassesProperty(t,a){for(var n=[t[a]];t.__proto__&&!t.__proto__.isPrototypeOf(Function);)t=t.__proto__,n.push(t[a]);return n}function disableCompatibilityMode(){compatibilityModeData_=null}function enableCompatibilityMode(t={}){compatibilityModeData_=t}function getCompatibilityModeData(){return!compatibilityModeData_&&'undefined'!=typeof window&&window.__METAL_COMPATIBILITY__&&enableCompatibilityMode(window.__METAL_COMPATIBILITY__),compatibilityModeData_}function getFunctionName(t){if(!t.name){var a=t.toString();t.name=a.substring(9,a.indexOf('('))}return t.name}function getUid(t,a){if(t){var n=t[UID_PROPERTY];return a&&!t.hasOwnProperty(UID_PROPERTY)&&(n=null),n||(t[UID_PROPERTY]=uniqueIdCounter_++)}return uniqueIdCounter_++}function identityFunction(t){return t}function isBoolean(t){return'boolean'==typeof t}function isDef(t){return t!==void 0}function isDefAndNotNull(t){return isDef(t)&&!isNull(t)}function isDocument(t){return t&&'object'==typeof t&&9===t.nodeType}function isElement(t){return t&&'object'==typeof t&&1===t.nodeType}function isFunction(t){return'function'==typeof t}function isNull(t){return null===t}function isNumber(t){return'number'==typeof t}function isWindow(t){return null!==t&&t===t.window}function isObject(t){var a=typeof t;return'object'==a&&null!==t||'function'==a}function isPromise(t){return t&&'object'==typeof t&&'function'==typeof t.then}function isString(t){return'string'==typeof t||t instanceof String}function mergeSuperClassesProperty(t,a,n){var r=a+'_MERGED';if(t.hasOwnProperty(r))return!1;var o=collectSuperClassesProperty(t,a);return n&&(o=n(o)),t[r]=o,!0}function nullFunction(){}var core$2=Object.freeze({UID_PROPERTY:UID_PROPERTY,abstractMethod:abstractMethod,collectSuperClassesProperty:collectSuperClassesProperty,disableCompatibilityMode:disableCompatibilityMode,enableCompatibilityMode:enableCompatibilityMode,getCompatibilityModeData:getCompatibilityModeData,getFunctionName:getFunctionName,getUid:getUid,identityFunction:identityFunction,isBoolean:isBoolean,isDef:isDef,isDefAndNotNull:isDefAndNotNull,isDocument:isDocument,isElement:isElement,isFunction:isFunction,isNull:isNull,isNumber:isNumber,isWindow:isWindow,isObject:isObject,isPromise:isPromise,isString:isString,mergeSuperClassesProperty:mergeSuperClassesProperty,nullFunction:nullFunction});class array{static equal(t,a){if(t.length!==a.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==a[n])return!1;return!0}static firstDefinedValue(t){for(var a=0;a<t.length;a++)if(t[a]!==void 0)return t[a]}static flatten(t,a){var n=a||[];for(var r=0;r<t.length;r++)Array.isArray(t[r])?array.flatten(t[r],n):n.push(t[r]);return n}static remove(t,a){var r,n=t.indexOf(a);return(r=0<=n)&&array.removeAt(t,n),r}static removeAt(t,a){return 1===Array.prototype.splice.call(t,a,1).length}static slice(t,a,n){var r=[],o=isDef(n)?n:t.length;for(var d=a;d<o;d++)r.push(t[d]);return r}}var async={};async.throwException=function(t){async.nextTick(function(){throw t})},async.run=function(t,a){async.run.workQueueScheduled_||(async.nextTick(async.run.processWorkQueue),async.run.workQueueScheduled_=!0),async.run.workQueue_.push(new async.run.WorkItem_(t,a))},async.run.workQueueScheduled_=!1,async.run.workQueue_=[],async.run.processWorkQueue=function(){for(;async.run.workQueue_.length;){var t=async.run.workQueue_;async.run.workQueue_=[];for(var a=0;a<t.length;a++){var n=t[a];try{n.fn.call(n.scope)}catch(r){async.throwException(r)}}}async.run.workQueueScheduled_=!1},async.run.WorkItem_=function(t,a){this.fn=t,this.scope=a},async.nextTick=function(t,a){var n=t;return a&&(n=t.bind(a)),n=async.nextTick.wrapCallback_(n),'function'==typeof setImmediate?void setImmediate(n):void(!async.nextTick.setImmediate_&&(async.nextTick.setImmediate_=async.nextTick.getSetImmediateEmulator_()),async.nextTick.setImmediate_(n))},async.nextTick.setImmediate_=null,async.nextTick.getSetImmediateEmulator_=function(){var t;if('function'==typeof MessageChannel&&(t=MessageChannel),'undefined'==typeof t&&'undefined'!=typeof window&&window.postMessage&&window.addEventListener&&(t=function(){var o=document.createElement('iframe');o.style.display='none',o.src='',document.documentElement.appendChild(o);var d=o.contentWindow,l=d.document;l.open(),l.write(''),l.close();var s='callImmediate'+Math.random(),u=d.location.protocol+'//'+d.location.host,c=function(h){h.origin!==u&&h.data!==s||this.port1.onmessage()}.bind(this);d.addEventListener('message',c,!1),this.port1={},this.port2={postMessage:function(){d.postMessage(s,u)}}}),'undefined'!=typeof t){var a=new t,n={},r=n;return a.port1.onmessage=function(){n=n.next;var o=n.cb;n.cb=null,o()},function(o){r.next={cb:o},r=r.next,a.port2.postMessage(0)}}return'undefined'!=typeof document&&'onreadystatechange'in document.createElement('script')?function(o){var d=document.createElement('script');d.onreadystatechange=function(){d.onreadystatechange=null,d.parentNode.removeChild(d),d=null,o(),o=null},document.documentElement.appendChild(d)}:function(o){setTimeout(o,0)}},async.nextTick.wrapCallback_=function(t){return t};class Disposable{constructor(){this.disposed_=!1}dispose(){this.disposed_||(this.disposeInternal(),this.disposed_=!0)}disposeInternal(){}isDisposed(){return this.disposed_}}class string{static collapseBreakingSpaces(t){return t.replace(/[\t\r\n ]+/g,' ').replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,'')}static escapeRegex(t){return(t+'').replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,'\\$1').replace(/\x08/g,'\\x08')}static getRandomString(){var t=2147483648;return Math.floor(Math.random()*t).toString(36)+Math.abs(Math.floor(Math.random()*t)^Date.now()).toString(36)}static hashCode(t){var a=0;for(var n=0,r=t.length;n<r;n++)a=31*a+t.charCodeAt(n),a%=4294967296;return a}static replaceInterval(t,a,n,r){return t.substring(0,a)+r+t.substring(n)}}class Embodied{constructor(){this.body_={}}body(){return this.body_}static toBody(t){return t instanceof Embodied?t.body():t}toString(){return JSON.stringify(this.body())}}class FilterBody{constructor(t,a,n){var r={operator:isDef(n)?a:'='},o=isDef(n)?n:a;isDefAndNotNull(o)&&(o instanceof Embodied&&(o=o.body()),r.value=o),isDefAndNotNull(t)?this.createBody_(t,r):this.createBody_('and',[])}add(t,a){a?this.addArrayOperator_(t,a):this.createBody_(t,this.body_)}addArrayOperator_(t,a){this.body_[t]instanceof Array||this.createBody_(t,[this.body_]),this.body_[t].push(a.body())}addMany(t,...a){for(var n=0;n<a.length;n++)this.add(t,a[n])}createBody_(t,a){this.body_={},this.body_[t]=a}getObject(){return this.body_}}class Geo{static boundingBox(t,a){return new Geo.BoundingBox(t,a)}static circle(t,a){return new Geo.Circle(t,a)}static line(...t){return new Geo.Line(...t)}static point(t,a){return new Geo.Point(t,a)}static polygon(...t){return new Geo.Polygon(...t)}}class Point extends Embodied{constructor(t,a){super(),this.body_=[t,a]}}Geo.Point=Point;class Line extends Embodied{constructor(...t){super(),this.body_={type:'linestring',coordinates:t.map(a=>Embodied.toBody(a))}}}Geo.Line=Line;class BoundingBox extends Embodied{constructor(t,a){super(),this.body_={type:'envelope',coordinates:[Embodied.toBody(t),Embodied.toBody(a)]}}getPoints(){return this.body_.coordinates}}Geo.BoundingBox=BoundingBox;class Circle extends Embodied{constructor(t,a){super(),this.body_={type:'circle',coordinates:Embodied.toBody(t),radius:a}}getCenter(){return this.body_.coordinates}getRadius(){return this.body_.radius}}Geo.Circle=Circle;class Polygon extends Embodied{constructor(...t){super(),this.body_={type:'polygon',coordinates:[]},this.addCoordinates_(...t)}addCoordinates_(...t){this.body_.coordinates.push(t.map(a=>Embodied.toBody(a)))}hole(...t){return this.addCoordinates_(...t),this}}Geo.Polygon=Polygon;class Range extends Embodied{constructor(t,a){super(),isDefAndNotNull(t)&&(this.body_.from=t),isDefAndNotNull(a)&&(this.body_.to=a)}static from(t){return new Range(t)}static range(t,a){return new Range(t,a)}static to(t){return new Range(null,t)}}class Filter extends Embodied{constructor(t,a,n){super(),this.body_=new FilterBody(t,a,n)}add(t,a,n,r){var o=a?Filter.toFilter(a,n,r):null;return this.body_.add(t,o),this}addMany(t,...a){return this.body_.addMany(t,...a),this}and(t,a,n){return this.add('and',t,a,n)}static any(t){var a=Array.prototype.slice.call(arguments,1);return 1===a.length&&a[0]instanceof Array&&(a=a[0]),new Filter(t,'any',a)}static boundingBox(t,a,n){return a instanceof Geo.BoundingBox?Filter.polygon(t,...a.getPoints()):Filter.polygon(t,a,n)}body(){return this.body_.getObject()}static distance(t,a,n){var r=a,o=n;return a instanceof Geo.Circle?(r=a.getCenter(),o=Range.to(a.getRadius())):!(n instanceof Range)&&(o=Range.to(n)),Filter.distanceInternal_(t,r,o)}static distanceInternal_(t,a,n){var r={location:Embodied.toBody(a)};return n=n.body(),n.from&&(r.min=n.from),n.to&&(r.max=n.to),Filter.field(t,'gd',r)}static equal(t,a){return new Filter(t,'=',a)}static exists(t){return Filter.field(t,'exists',null)}static fuzzy(t,a,n){return Filter.fuzzyInternal_('fuzzy',t,a,n)}static fuzzyInternal_(t,a,n,r){var o=isString(n),d={query:o?n:a},l=o?r:n;l&&(d.fuzziness=l);var s=o?a:Filter.ALL;return Filter.field(s,t,d)}static gt(t,a){return new Filter(t,'>',a)}static gte(t,a){return new Filter(t,'>=',a)}static match(t,a){var n=isString(a)?t:Filter.ALL,r=isString(a)?a:t;return Filter.field(n,'match',r)}static missing(t){return Filter.field(t,'missing',null)}static phrase(t,a){var n=isString(a)?t:Filter.ALL,r=isString(a)?a:t;return Filter.field(n,'phrase',r)}static polygon(t,...a){return a=a.map(n=>Embodied.toBody(n)),Filter.field(t,'gp',a)}static prefix(t,a){var n=a?t:Filter.ALL,r=a?a:t;return Filter.field(n,'prefix',r)}static range(t,a,n){var r=a;return r instanceof Range||(r=Range.range(a,n)),Filter.field(t,'range',r)}static regex(t,a){return new Filter(t,'~',a)}static shape(t,...a){a=a.map(r=>Embodied.toBody(r));var n={type:'geometrycollection',geometries:a};return Filter.field(t,'gs',n)}static similar(t,a){var n=isString(a)?t:Filter.ALL,r={query:isString(a)?a:t};return Filter.field(n,'similar',r)}static lt(t,a){return new Filter(t,'<',a)}static lte(t,a){return new Filter(t,'<=',a)}static none(t){var a=Array.prototype.slice.call(arguments,1);return 1===a.length&&a[0]instanceof Array&&(a=a[0]),new Filter(t,'none',a)}static notEqual(t,a){return new Filter(t,'!=',a)}static not(t,a,n){return Filter.toFilter(t,a,n).add('not')}static field(t,a,n){return new Filter(t,a,n)}or(t,a,n){return this.add('or',t,a,n)}static toFilter(t,a,n){var r=t;return r instanceof Filter||(r=Filter.field(t,a,n)),r}}Filter.ALL='*';function parseFromAnchor(t){var a=document.createElement('a');return a.href=t,{hash:a.hash,hostname:a.hostname,password:a.password,pathname:'/'===a.pathname[0]?a.pathname:'/'+a.pathname,port:a.port,protocol:a.protocol,search:a.search,username:a.username}}function parse(t){return isFunction(URL)&&URL.length?new URL(t):parseFromAnchor(t)}var create=Object.create;class MultiMap extends Disposable{constructor(){super(),this.keys=create(null),this.values=create(null)}add(t,a){return this.keys[t.toLowerCase()]=t,this.values[t.toLowerCase()]=this.values[t.toLowerCase()]||[],this.values[t.toLowerCase()].push(a),this}clear(){return this.keys=create(null),this.values=create(null),this}contains(t){return t.toLowerCase()in this.values}disposeInternal(){this.values=null}static fromObject(t){var a=new MultiMap,n=Object.keys(t);for(var r=0;r<n.length;r++)a.set(n[r],t[n[r]]);return a}get(t){var a=this.values[t.toLowerCase()];if(a)return a[0]}getAll(t){return this.values[t.toLowerCase()]}isEmpty(){return 0===this.size()}names(){return Object.keys(this.values).map(t=>this.keys[t])}remove(t){return delete this.keys[t.toLowerCase()],delete this.values[t.toLowerCase()],this}set(t,a){return this.keys[t.toLowerCase()]=t,this.values[t.toLowerCase()]=[a],this}size(){return this.names().length}toString(){return JSON.stringify(this.values)}}const assertChildHasNoParent=function(t){if(t.getParent())throw new Error('Cannot add child with parent.')};var parseFn_=parse;class Uri{constructor(t=''){this.url=Uri.parse(this.maybeAddProtocolAndHostname_(t))}addParametersFromMultiMap(t){return t.names().forEach(a=>{t.getAll(a).forEach(n=>{this.addParameterValue(a,n)})}),this}addParameterValue(t,a){return this.ensureQueryInitialized_(),isDef(a)&&(a=a+''),this.query.add(t,a),this}addParameterValues(t,a){return a.forEach(n=>this.addParameterValue(t,n)),this}ensureQueryInitialized_(){if(!this.query){this.query=new MultiMap;var t=this.url.search;t&&t.substring(1).split('&').forEach(a=>{var[n,r]=a.split('=');isDef(r)&&(r=Uri.urlDecode(r)),this.addParameterValue(n,r)})}}getHash(){return this.url.hash||''}getHost(){var t=this.getHostname();if(t){var a=this.getPort();a&&'80'!==a&&(t+=':'+a)}return t}getHostname(){var t=this.url.hostname;return t===Uri.HOSTNAME_PLACEHOLDER?'':t}getOrigin(){var t=this.getHost();return t?this.getProtocol()+'//'+t:''}getParameterValue(t){return this.ensureQueryInitialized_(),this.query.get(t)}getParameterValues(t){return this.ensureQueryInitialized_(),this.query.getAll(t)}getParameterNames(){return this.ensureQueryInitialized_(),this.query.names()}static getParseFn(){return parseFn_}getPathname(){return this.url.pathname}getPort(){return this.url.port}getProtocol(){return this.url.protocol}getSearch(){var t='',a='';return this.getParameterNames().forEach(n=>{this.getParameterValues(n).forEach(r=>{a+=n,isDef(r)&&(a+='='+encodeURIComponent(r)),a+='&'})}),a=a.slice(0,-1),a&&(t+='?'+a),t}hasParameter(t){return this.ensureQueryInitialized_(),this.query.contains(t)}makeUnique(){return this.setParameterValue(Uri.RANDOM_PARAM,string.getRandomString()),this}maybeAddProtocolAndHostname_(t){var a=t;if(-1===t.indexOf('://')&&0!==t.indexOf('javascript:'))switch(a=Uri.DEFAULT_PROTOCOL,('/'!==t[0]||'/'!==t[1])&&(a+='//'),t.charAt(0)){case'.':case'?':case'#':a+=Uri.HOSTNAME_PLACEHOLDER,a+='/',a+=t;break;case'':case'/':'/'!==t[1]&&(a+=Uri.HOSTNAME_PLACEHOLDER),a+=t;break;default:a+=t;}return a}static normalizeObject(t){var a=t.pathname?t.pathname.length:0;return 1<a&&'/'===t.pathname[a-1]&&(t.pathname=t.pathname.substr(0,a-1)),t}static parse(t){return Uri.normalizeObject(parseFn_(t))}removeParameter(t){return this.ensureQueryInitialized_(),this.query.remove(t),this}removeUnique(){return this.removeParameter(Uri.RANDOM_PARAM),this}setHash(t){return this.url.hash=t,this}setHostname(t){return this.url.hostname=t,this}setParameterValue(t,a){return this.removeParameter(t),this.addParameterValue(t,a),this}setParameterValues(t,a){return this.removeParameter(t),a.forEach(n=>this.addParameterValue(t,n)),this}setPathname(t){return this.url.pathname=t,this}setPort(t){return this.url.port=t,this}static setParseFn(t){parseFn_=t}setProtocol(t){return this.url.protocol=t,':'!==this.url.protocol[this.url.protocol.length-1]&&(this.url.protocol+=':'),this}toString(){var t='',a=this.getHost();return a&&(t+=this.getProtocol()+'//'),t+=a+this.getPathname()+this.getSearch()+this.getHash(),t}static joinPaths(t,...a){return'/'===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),a=a.map(n=>'/'===n.charAt(0)?n.substring(1):n),[t].concat(a).join('/').replace(/\/$/,'')}static urlDecode(t){return decodeURIComponent(t.replace(/\+/g,' '))}}Uri.DEFAULT_PROTOCOL='http:',Uri.HOSTNAME_PLACEHOLDER='hostname'+Date.now(),Uri.RANDOM_PARAM='zx';function assertBrowserEnvironment(){if(!globals.window)throw new Error('Sign-in type not supported in this environment')}function assertDefAndNotNull(t,a){if(!isDefAndNotNull(t))throw new Error(a)}function assertFunction(t,a){if(!isFunction(t))throw new Error(a)}function assertObject(t,a){if(!isObject(t))throw new Error(a)}function assertResponseSucceeded(t){if(!t.succeeded())throw t.body();return t}function assertUserSignedIn(t){if(!isDefAndNotNull(t))throw new Error('You must be signed-in to perform this operation')}function assertUriWithNoPath(t,a){var n=new Uri(t);if(1<n.getPathname().length)throw new Error(a)}class Auth{constructor(t,a=null){this.token=isString(a)?null:t,this.email=isString(a)?t:null,this.password=a,this.createdAt=null,this.id=null,this.name=null,this.photoUrl=null,this.wedeployClient=null}static create(t,a){return new Auth(t,a)}getCreatedAt(){return this.createdAt}getEmail(){return this.email}getId(){return this.id}getName(){return this.name}getPassword(){return this.password}getPhotoUrl(){return this.photoUrl}getToken(){return this.token}hasCreatedAt(){return isDefAndNotNull(this.createdAt)}hasEmail(){return isDefAndNotNull(this.email)}hasId(){return isDefAndNotNull(this.id)}hasName(){return isDefAndNotNull(this.name)}hasPassword(){return isDefAndNotNull(this.password)}hasPhotoUrl(){return isDefAndNotNull(this.photoUrl)}hasToken(){return isDefAndNotNull(this.token)}setCreatedAt(t){this.createdAt=t}setEmail(t){this.email=t}setId(t){this.id=t}setName(t){this.name=t}setPassword(t){this.password=t}setPhotoUrl(t){this.photoUrl=t}setToken(t){this.token=t}setWedeployClient(t){this.wedeployClient=t}updateUser(t){return assertObject(t,'User data must be specified as object'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/users').auth(this).patch(t).then(a=>assertResponseSucceeded(a))}deleteUser(){return assertDefAndNotNull(this.id,'Cannot delete user without id'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/users',this.id).auth(this).delete().then(t=>assertResponseSucceeded(t))}}class ApiHelper{constructor(t){assertDefAndNotNull(t,'WeDeploy client reference must be specified'),this.wedeployClient=t}auth(t,a){return this.helperAuthScope=t,this.helperAuthScope instanceof Auth||(this.helperAuthScope=Auth.create(t,a)),this}}class AuthProvider{constructor(){this.provider=null,this.providerScope=null,this.redirectUri=null,this.scope=null}hasProvider(){return isDefAndNotNull(this.provider)}hasProviderScope(){return isDefAndNotNull(this.providerScope)}hasRedirectUri(){return isDefAndNotNull(this.redirectUri)}hasScope(){return isDefAndNotNull(this.scope)}makeAuthorizationUrl(t){var a=new Uri(t);return a.setPathname('/oauth/authorize'),this.hasProvider()&&a.setParameterValue('provider',this.getProvider()),this.hasProviderScope()&&a.setParameterValue('provider_scope',this.getProviderScope()),this.hasRedirectUri()&&a.setParameterValue('redirect_uri',this.getRedirectUri()),this.hasScope()&&a.setParameterValue('scope',this.getScope()),a.toString()}getProvider(){return this.provider}getProviderScope(){return this.providerScope}getRedirectUri(){return this.redirectUri}getScope(){return this.scope}setProviderScope(t){assertStringIfDefAndNotNull(t,'Provider scope must be a string'),this.providerScope=t}setRedirectUri(t){assertStringIfDefAndNotNull(t,'Redirect uri must be a string'),this.redirectUri=t}setScope(t){assertStringIfDefAndNotNull(t,'Scope must be a string'),this.scope=t}}function assertStringIfDefAndNotNull(t,a){if(isDefAndNotNull(t)&&!isString(t))throw new Error(a)}class FacebookAuthProvider extends AuthProvider{constructor(){super(),this.provider=FacebookAuthProvider.PROVIDER}}FacebookAuthProvider.PROVIDER='facebook';class GithubAuthProvider extends AuthProvider{constructor(){super(),this.provider=GithubAuthProvider.PROVIDER}}GithubAuthProvider.PROVIDER='github';class GoogleAuthProvider extends AuthProvider{constructor(){super(),this.provider=GoogleAuthProvider.PROVIDER}}GoogleAuthProvider.PROVIDER='google';class StorageMechanism{clear(){throw Error('Unimplemented abstract method')}set(t,a){throw Error('Unimplemented abstract method')}get(t){throw Error('Unimplemented abstract method')}static isSupported(){return!0}keys(){throw Error('Unimplemented abstract method')}remove(t){throw Error('Unimplemented abstract method')}size(){throw Error('Unimplemented abstract method')}}class Storage{constructor(t){assertMechanismDefAndNotNull(t),assertMechanismIntanceOf(t),this.mechanism=t}clear(){this.mechanism.clear()}set(t,a){return core$2.isDef(a)?void this.mechanism.set(t,JSON.stringify(a)):void this.mechanism.remove(t)}get(t){var a;try{a=this.mechanism.get(t)}catch(n){return void 0}if(core$2.isNull(a))return void 0;try{return JSON.parse(a)}catch(n){throw Storage.ErrorCode.INVALID_VALUE}}keys(){return this.mechanism.keys()}remove(t){this.mechanism.remove(t)}size(){return this.mechanism.size()}values(){return this.keys().map(t=>this.get(t))}}Storage.ErrorCode={INVALID_VALUE:'Storage: Invalid value was encountered'};function assertMechanismDefAndNotNull(t){if(!core$2.isDefAndNotNull(t))throw Error('Storage mechanism is required')}function assertMechanismIntanceOf(t){if(!(t instanceof StorageMechanism))throw Error('Storage mechanism must me an implementation of StorageMechanism')}class LocalStorageMechanism extends StorageMechanism{storage(){return LocalStorageMechanism.globals.localStorage}clear(){this.storage().clear()}keys(){return Object.keys(this.storage())}get(t){return this.storage().getItem(t)}static isSupported(){return'undefined'!=typeof window}remove(t){this.storage().removeItem(t)}set(t,a){this.storage().setItem(t,a)}size(){return this.storage().length}}LocalStorageMechanism.isSupported()&&(LocalStorageMechanism.globals={localStorage:window.localStorage});class AuthApiHelper extends ApiHelper{constructor(t){super(t),this.currentUser=null,this.onSignInCallback=null,this.onSignOutCallback=null,LocalStorageMechanism.isSupported()&&(this.storage=new Storage(new LocalStorageMechanism())),this.processSignIn_(),this.provider={Facebook:FacebookAuthProvider,Google:GoogleAuthProvider,Github:GithubAuthProvider}}createUser(t){return assertObject(t,'User data must be specified as object'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/users').post(t).then(a=>assertResponseSucceeded(a)).then(a=>this.makeUserAuthFromData(a.body()))}getHrefWithoutFragment_(){var t=globals.window.location;return t.protocol+'//'+t.host+t.pathname+(t.search?t.search:'')}getRedirectAccessToken_(){if(globals.window){var t=globals.window.location.hash;if(0===t.indexOf('#access_token='))return t.substring(14)}return null}getUser(t){return assertDefAndNotNull(t,'User userId must be specified'),assertUserSignedIn(this.currentUser),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/users',t).auth(this.resolveAuthScope().token).get().then(a=>assertResponseSucceeded(a)).then(a=>this.makeUserAuthFromData(a.body()))}loadCurrentUser(t){return assertDefAndNotNull(t,'User token must be specified'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/user').auth(t).get().then(a=>{var n=a.body();return n.token=t,this.currentUser=this.makeUserAuthFromData(n),this.storage&&this.storage.set('currentUser',n),this.currentUser})}makeUserAuthFromData(t){var a=new Auth;return a.setWedeployClient(this.wedeployClient),a.setCreatedAt(t.createdAt),a.setEmail(t.email),a.setId(t.id),a.setName(t.name),a.setPhotoUrl(t.photoUrl),a.setToken(t.token),a}maybeCallOnSignInCallback_(){this.onSignInCallback&&this.onSignInCallback.call(this,this.currentUser)}maybeCallOnSignOutCallback_(){this.onSignOutCallback&&this.onSignOutCallback.call(this,this.currentUser)}onSignIn(t){assertFunction(t,'Sign-in callback must be a function'),this.onSignInCallback=t}onSignOut(t){assertFunction(t,'Sign-out callback must be a function'),this.onSignOutCallback=t}processSignIn_(){var t=this.getRedirectAccessToken_();if(t)return this.removeUrlFragmentCompletely_(),void this.loadCurrentUser(t).then(()=>this.maybeCallOnSignInCallback_());var a=this.storage&&this.storage.get('currentUser');a&&(this.currentUser=this.makeUserAuthFromData(a))}removeUrlFragmentCompletely_(){globals.window.history.pushState({},document.title,window.location.pathname+window.location.search)}resolveAuthScope(){return this.helperAuthScope?this.helperAuthScope:this.currentUser}sendPasswordResetEmail(t){return assertDefAndNotNull(t,'Send password reset email must be specified'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/user/recover').param('email',t).post().then(a=>assertResponseSucceeded(a))}signInWithEmailAndPassword(t,a){return assertDefAndNotNull(t,'Sign-in email must be specified'),assertDefAndNotNull(a,'Sign-in password must be specified'),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/oauth/token').param('grant_type','password').param('username',t).param('password',a).get().then(n=>assertResponseSucceeded(n)).then(n=>this.loadCurrentUser(n.body().access_token)).then(n=>{return this.maybeCallOnSignInCallback_(),n})}signInWithRedirect(t){assertBrowserEnvironment(),assertDefAndNotNull(t,'Sign-in provider must be defined'),assertSupportedProvider(t),t.hasRedirectUri()||t.setRedirectUri(this.getHrefWithoutFragment_()),globals.window.location.href=t.makeAuthorizationUrl(this.wedeployClient.authUrl_)}signOut(){return assertUserSignedIn(this.currentUser),this.wedeployClient.url(this.wedeployClient.authUrl_).path('/oauth/revoke').param('token',this.currentUser.token).get().then(t=>assertResponseSucceeded(t)).then(t=>{return this.maybeCallOnSignOutCallback_(),this.unloadCurrentUser_(),t})}unloadCurrentUser_(){this.currentUser=null,this.storage&&this.storage.remove('currentUser')}}function assertSupportedProvider(t){switch(t.constructor.PROVIDER){case FacebookAuthProvider.PROVIDER:case GithubAuthProvider.PROVIDER:case GoogleAuthProvider.PROVIDER:break;default:throw new Error('Sign-in provider not supported');}}class Aggregation{constructor(t,a,n){this.field_=t,this.operator_=a,this.value_=n}static avg(t){return Aggregation.field(t,'avg')}static count(t){return Aggregation.field(t,'count')}static distance(t,a,...n){return new Aggregation.DistanceAggregation(t,a,...n)}static extendedStats(t){return Aggregation.field(t,'extendedStats')}getField(){return this.field_}getOperator(){return this.operator_}getValue(){return this.value_}static histogram(t,a){return new Aggregation(t,'histogram',a)}static max(t){return Aggregation.field(t,'max')}static min(t){return Aggregation.field(t,'min')}static missing(t){return Aggregation.field(t,'missing')}static field(t,a){return new Aggregation(t,a)}static range(t,...a){return new Aggregation.RangeAggregation(t,...a)}static stats(t){return Aggregation.field(t,'stats')}static sum(t){return Aggregation.field(t,'sum')}static terms(t){return Aggregation.field(t,'terms')}}class DistanceAggregation extends Aggregation{constructor(t,a,...n){super(t,'geoDistance',{}),this.value_.location=Embodied.toBody(a),this.value_.ranges=n.map(r=>r.body())}range(t,a){var n=t;return n instanceof Range||(n=Range.range(t,a)),this.value_.ranges.push(n.body()),this}unit(t){return this.value_.unit=t,this}}Aggregation.DistanceAggregation=DistanceAggregation;class RangeAggregation extends Aggregation{constructor(t,...a){super(t,'range'),this.value_=a.map(n=>n.body())}range(t,a){var n=t;return n instanceof Range||(n=Range.range(t,a)),this.value_.push(n.body()),this}}Aggregation.RangeAggregation=RangeAggregation;class Query extends Embodied{static aggregate(t,a,n){return new Query().aggregate(t,a,n)}static count(){return new Query().type('count')}static fetch(){return new Query().type('fetch')}static filter(t,a,n){return new Query().filter(t,a,n)}static offset(t){return new Query().offset(t)}static highlight(t){return new Query().highlight(t)}static limit(t){return new Query().limit(t)}static search(t,a,n){return new Query().search(t,a,n)}static sort(t,a){return new Query().sort(t,a)}static type(t){return new Query().type(t)}aggregate(t,a,n){var r=a;r instanceof Aggregation||(r=Aggregation.field(a,n));var o=r.getField(),d={};return d[o]={name:t,operator:r.getOperator()},isDefAndNotNull(r.getValue())&&(d[o].value=r.getValue()),this.body_.aggregation||(this.body_.aggregation=[]),this.body_.aggregation.push(d),this}count(){return this.type('count')}fetch(){return this.type('fetch')}filter(t,a,n){let r=Filter.toFilter(t,a,n);return this.body_.filter||(this.body_.filter=[]),this.body_.filter.push(r.body()),this}offset(t){return this.body_.offset=t,this}highlight(t){return this.body_.highlight||(this.body_.highlight=[]),this.body_.highlight.push(t),this}limit(t){return this.body_.limit=t,this}search(t,a,n){var r=t;return n?r=Filter.field(t,a,n):a?r=Filter.match(t,a):!(r instanceof Filter)&&(r=Filter.match(t)),this.body_.search||(this.body_.search=[]),isDefAndNotNull(t)?this.body_.search.push(r.body()):this.body_.search.push({}),this}sort(t,a){this.body_.sort||(this.body_.sort=[]);var n={};return n[t]=a||'asc',this.body_.sort.push(n),this}type(t){return this.body_.type=t,this}}class DataApiHelper extends ApiHelper{constructor(t){super(t)}where(t,a,n){return this.getOrCreateFilter_().and(t,a,n),this}or(t,a,n){if(0===this.getOrCreateFilter_().body().and.length)throw Error('It\'s required to have a condition before using an \'or()\' for the first time.');return this.getOrCreateFilter_().or(t,a,n),this}none(t,...a){return this.where(Filter.none(t,a))}match(t,a){return this.where(Filter.match(t,a))}similar(t,a){return this.where(Filter.similar(t,a))}lt(t,a){return this.where(Filter.lt(t,a))}lte(t,a){return this.where(Filter.lte(t,a))}any(t,...a){return this.where(Filter.any(t,a))}boundingBox(t,a,n){return this.where(Filter.boundingBox(t,a,n))}distance(t,a,n){return this.where(Filter.distance(t,a,n))}range(t,a,n){return this.where(Filter.range(t,a,n))}limit(t){return this.getOrCreateQuery_().limit(t),this}offset(t){return this.getOrCreateQuery_().offset(t),this}highlight(t){return this.getOrCreateQuery_().highlight(t),this}aggregate(t,a,n){return this.getOrCreateQuery_().aggregate(t,a,n),this}count(){return this.getOrCreateQuery_().type('count'),this}orderBy(t,a){return this.getOrCreateQuery_().sort(t,a),this}create(t,a){return assertDefAndNotNull(t,'Collection key must be specified.'),assertObject(a,'Data can\'t be empty.'),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).post(a).then(n=>assertResponseSucceeded(n)).then(n=>n.body())}update(t,a){return assertDefAndNotNull(t,'Document key must be specified.'),assertObject(a,'Data must be specified.'),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).put(a).then(n=>assertResponseSucceeded(n)).then(n=>n.body())}delete(t){return assertDefAndNotNull(t,'Document/Field/Collection key must be specified'),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).delete().then(a=>assertResponseSucceeded(a)).then(()=>void 0)}get(t){return assertDefAndNotNull(t,'Document/Field/Collection key must be specified'),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).get(this.query_).then(a=>assertResponseSucceeded(a)).then(a=>a.body())}search(t){return assertDefAndNotNull(t,'Document/Field/Collection key must be specified'),this.onSearch_(),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).get(this.query_).then(a=>assertResponseSucceeded(a)).then(a=>a.body())}watch(t,a){return assertDefAndNotNull(t,'Collection key must be specified'),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(t).watch(this.query_,a)}getOrCreateFilter_(){return this.filter_||(this.filter_=new Filter),this.filter_}getOrCreateQuery_(){return this.query_||(this.query_=new Query),this.query_}addFiltersToQuery_(){return isDef(this.filter_)&&!0!==this.toSearch_&&this.getOrCreateQuery_().filter(this.filter_),this}onSearch_(){if(isDef(this.filter_))this.getOrCreateQuery_().search(this.getOrCreateFilter_());else throw Error('It\'s required to have a condition before using an \'search()\' for the first time.');return this.toSearch_=!0,this}}class Base64{static encodeString(t){return'function'==typeof btoa?btoa(t):new Buffer(t.toString(),'binary')}}var Thenable=function(){};Thenable.prototype.then=function(){},Thenable.IMPLEMENTED_BY_PROP='$goog_Thenable',Thenable.addImplementation=function(t){t.prototype.then=t.prototype.then,t.prototype.$goog_Thenable=!0},Thenable.isImplementedBy=function(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(a){return!1}};var partial=function(t){var a=Array.prototype.slice.call(arguments,1);return function(){var n=a.slice();return n.push.apply(n,arguments),t.apply(this,n)}},CancellablePromise=function(t,a){this.state_=CancellablePromise.State_.PENDING,this.result_=void 0,this.parent_=null,this.callbackEntries_=null,this.executing_=!1,0<CancellablePromise.UNHANDLED_REJECTION_DELAY?this.unhandledRejectionId_=0:0===CancellablePromise.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1);try{var n=this;t.call(a,function(r){n.resolve_(CancellablePromise.State_.FULFILLED,r)},function(r){n.resolve_(CancellablePromise.State_.REJECTED,r)})}catch(r){this.resolve_(CancellablePromise.State_.REJECTED,r)}};CancellablePromise.UNHANDLED_REJECTION_DELAY=0,CancellablePromise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3},CancellablePromise.CallbackEntry_=null,CancellablePromise.resolve=function(t){return new CancellablePromise(function(a){a(t)})},CancellablePromise.reject=function(t){return new CancellablePromise(function(a,n){n(t)})},CancellablePromise.race=function(t){return new CancellablePromise(function(a,n){t.length||a(void 0);for(var o,r=0;o=t[r];r++)o.then(a,n)})},CancellablePromise.all=function(t){return new CancellablePromise(function(a,n){var r=t.length,o=[];if(!r)return void a(o);var d=function(c,h){r--,o[c]=h,0===r&&a(o)},l=function(c){n(c)};for(var u,s=0;u=t[s];s++)u.then(partial(d,s),l)})},CancellablePromise.firstFulfilled=function(t){return new CancellablePromise(function(a,n){var r=t.length,o=[];if(!r)return void a(void 0);var d=function(c){a(c)},l=function(c,h){r--,o[c]=h,0===r&&n(o)};for(var u,s=0;u=t[s];s++)u.then(d,partial(l,s))})},CancellablePromise.prototype.then=function(t,a,n){return this.addChildPromise_(isFunction(t)?t:null,isFunction(a)?a:null,n)},Thenable.addImplementation(CancellablePromise),CancellablePromise.prototype.thenAlways=function(t,a){var n=function(){try{t.call(a)}catch(r){CancellablePromise.handleRejection_.call(null,r)}};return this.addCallbackEntry_({child:null,onRejected:n,onFulfilled:n}),this},CancellablePromise.prototype.thenCatch=function(t,a){return this.addChildPromise_(null,t,a)},CancellablePromise.prototype.catch=CancellablePromise.prototype.thenCatch,CancellablePromise.prototype.cancel=function(t){this.state_===CancellablePromise.State_.PENDING&&async.run(function(){var a=new CancellablePromise.CancellationError(t);a.IS_CANCELLATION_ERROR=!0,this.cancelInternal_(a)},this)},CancellablePromise.prototype.cancelInternal_=function(t){this.state_===CancellablePromise.State_.PENDING&&(this.parent_?this.parent_.cancelChild_(this,t):this.resolve_(CancellablePromise.State_.REJECTED,t))},CancellablePromise.prototype.cancelChild_=function(t,a){if(this.callbackEntries_){var n=0,r=-1;for(var d,o=0;d=this.callbackEntries_[o];o++){var l=d.child;if(l&&(n++,l===t&&(r=o),0<=r&&1<n))break}if(0<=r)if(this.state_===CancellablePromise.State_.PENDING&&1==n)this.cancelInternal_(a);else{var s=this.callbackEntries_.splice(r,1)[0];this.executeCallback_(s,CancellablePromise.State_.REJECTED,a)}}},CancellablePromise.prototype.addCallbackEntry_=function(t){this.callbackEntries_&&this.callbackEntries_.length||this.state_!==CancellablePromise.State_.FULFILLED&&this.state_!==CancellablePromise.State_.REJECTED||this.scheduleCallbacks_(),this.callbackEntries_||(this.callbackEntries_=[]),this.callbackEntries_.push(t)},CancellablePromise.prototype.addChildPromise_=function(t,a,n){var r={child:null,onFulfilled:null,onRejected:null};return r.child=new CancellablePromise(function(o,d){r.onFulfilled=t?function(l){try{var s=t.call(n,l);o(s)}catch(u){d(u)}}:o,r.onRejected=a?function(l){try{var s=a.call(n,l);!isDef(s)&&l.IS_CANCELLATION_ERROR?d(l):o(s)}catch(u){d(u)}}:d}),r.child.parent_=this,this.addCallbackEntry_(r),r.child},CancellablePromise.prototype.unblockAndFulfill_=function(t){if(this.state_!==CancellablePromise.State_.BLOCKED)throw new Error('CancellablePromise is not blocked.');this.state_=CancellablePromise.State_.PENDING,this.resolve_(CancellablePromise.State_.FULFILLED,t)},CancellablePromise.prototype.unblockAndReject_=function(t){if(this.state_!==CancellablePromise.State_.BLOCKED)throw new Error('CancellablePromise is not blocked.');this.state_=CancellablePromise.State_.PENDING,this.resolve_(CancellablePromise.State_.REJECTED,t)},CancellablePromise.prototype.resolve_=function(t,a){if(this.state_===CancellablePromise.State_.PENDING){if(this===a)t=CancellablePromise.State_.REJECTED,a=new TypeError('CancellablePromise cannot resolve to itself');else{if(Thenable.isImplementedBy(a))return a=a,this.state_=CancellablePromise.State_.BLOCKED,void a.then(this.unblockAndFulfill_,this.unblockAndReject_,this);if(isObject(a))try{var n=a.then;if(isFunction(n))return void this.tryThen_(a,n)}catch(r){t=CancellablePromise.State_.REJECTED,a=r}}this.result_=a,this.state_=t,this.scheduleCallbacks_(),t!==CancellablePromise.State_.REJECTED||a.IS_CANCELLATION_ERROR||CancellablePromise.addUnhandledRejection_(this,a)}},CancellablePromise.prototype.tryThen_=function(t,a){this.state_=CancellablePromise.State_.BLOCKED;var n=this,r=!1,o=function(l){r||(r=!0,n.unblockAndFulfill_(l))},d=function(l){r||(r=!0,n.unblockAndReject_(l))};try{a.call(t,o,d)}catch(l){d(l)}},CancellablePromise.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,async.run(this.executeCallbacks_,this))},CancellablePromise.prototype.executeCallbacks_=function(){for(;this.callbackEntries_&&this.callbackEntries_.length;){var t=this.callbackEntries_;this.callbackEntries_=[];for(var a=0;a<t.length;a++)this.executeCallback_(t[a],this.state_,this.result_)}this.executing_=!1},CancellablePromise.prototype.executeCallback_=function(t,a,n){a===CancellablePromise.State_.FULFILLED?t.onFulfilled(n):(this.removeUnhandledRejection_(),t.onRejected(n))},CancellablePromise.prototype.removeUnhandledRejection_=function(){var t;if(0<CancellablePromise.UNHANDLED_REJECTION_DELAY)for(t=this;t&&t.unhandledRejectionId_;t=t.parent_)clearTimeout(t.unhandledRejectionId_),t.unhandledRejectionId_=0;else if(0===CancellablePromise.UNHANDLED_REJECTION_DELAY)for(t=this;t&&t.hadUnhandledRejection_;t=t.parent_)t.hadUnhandledRejection_=!1},CancellablePromise.addUnhandledRejection_=function(t,a){0<CancellablePromise.UNHANDLED_REJECTION_DELAY?t.unhandledRejectionId_=setTimeout(function(){CancellablePromise.handleRejection_.call(null,a)},CancellablePromise.UNHANDLED_REJECTION_DELAY):0===CancellablePromise.UNHANDLED_REJECTION_DELAY&&(t.hadUnhandledRejection_=!0,async.run(function(){t.hadUnhandledRejection_&&CancellablePromise.handleRejection_.call(null,a)}))},CancellablePromise.handleRejection_=async.throwException,CancellablePromise.setUnhandledRejectionHandler=function(t){CancellablePromise.handleRejection_=t},CancellablePromise.CancellationError=class extends Error{constructor(t){super(t),t&&(this.message=t)}},CancellablePromise.CancellationError.prototype.name='cancel';class Ajax{static parseResponseHeaders(t){var a=[];if(!t)return a;var n=t.split('\r\n');for(var r=0;r<n.length;r++){var o=n[r].indexOf(': ');if(0<o){var d=n[r].substring(0,o),l=n[r].substring(o+2);a.push({name:d,value:l})}}return a}static request(t,a,n,r,o,d,l,s){t=t||'',a=a||'GET';var u=new XMLHttpRequest,c=new CancellablePromise(function(_,m){u.onload=function(){return u.aborted?void u.onerror():void _(u)},u.onerror=function(){var y=new Error('Request error');y.request=u,m(y)}}).thenCatch(function(_){throw u.abort(),_}).thenAlways(function(){clearTimeout(h)});if(o&&(t=new Uri(t).addParametersFromMultiMap(o).toString()),u.open(a,t,!l),s&&(u.withCredentials=!0),r&&r.names().forEach(function(_){u.setRequestHeader(_,r.getAll(_).join(', '))}),u.send(isDef(n)?n:null),isDefAndNotNull(d))var h=setTimeout(function(){c.cancel('Request timeout')},d);return c}}class Transport{send(){}}class ClientMessage{constructor(){this.headers_=new MultiMap}body(t){return isDef(t)?(this.body_=t,this):this.body_}header(t,a){if(2!==arguments.length)throw new Error('Invalid arguments');return this.headers_.set(t,a),this}headers(t){return isDef(t)?(t instanceof MultiMap?this.headers_=t:this.headers_.values=t,t):this.headers_}removeBody(){this.body_=void 0}}class ClientResponse extends ClientMessage{constructor(t){if(super(),!t)throw new Error('Can\'t create response without request');this.clientRequest_=t}request(){return this.clientRequest_}statusCode(t){return isDef(t)?(this.statusCode_=t,this):this.statusCode_}statusText(t){return isDef(t)?(this.statusText_=t,this):this.statusText_}succeeded(){return 200<=this.statusCode()&&399>=this.statusCode()}}class AjaxTransport extends Transport{send(t){var a=Ajax.request(t.url(),t.method(),t.body(),t.headers(),t.params(),null,!1,t.withCredentials());return a.then(function(n){var r=new ClientResponse(t);return r.body(n.responseText),r.statusCode(n.status),r.statusText(n.statusText),Ajax.parseResponseHeaders(n.getAllResponseHeaders()).forEach(function(o){r.header(o.name,o.value)}),r})}}class TransportFactory{constructor(){this.transports={},this.transports[TransportFactory.DEFAULT_TRANSPORT_NAME]=TransportFactory[TransportFactory.DEFAULT_TRANSPORT_NAME]}static instance(){return TransportFactory.instance_||(TransportFactory.instance_=new TransportFactory),TransportFactory.instance_}get(t){var a=this.transports[t];if(!a)throw new Error('Invalid transport name: '+t);try{return new a}catch(n){throw new Error('Can\'t create transport',n)}}getDefault(){return this.get(TransportFactory.DEFAULT_TRANSPORT_NAME)}}TransportFactory.DEFAULT_TRANSPORT_NAME='default',TransportFactory[TransportFactory.DEFAULT_TRANSPORT_NAME]=AjaxTransport;class ClientRequest extends ClientMessage{constructor(){super(),this.params_=new MultiMap,this.withCredentials_=!0}withCredentials(t){return isDef(t)?(this.withCredentials_=!!t,this):this.withCredentials_}method(t){return isDef(t)?(this.method_=t,this):this.method_||ClientRequest.DEFAULT_METHOD}param(t,a){if(2!==arguments.length)throw new Error('Invalid arguments');return this.params_.set(t,a),this}params(t){return isDef(t)?(t instanceof MultiMap?this.params_=t:this.params_.values=t,t):this.params_}url(t){return isDef(t)?(this.url_=t,this):this.url_}}ClientRequest.DEFAULT_METHOD='GET';var io;'undefined'!=typeof globals.window&&(io=globals.window.io);class WeDeploy$1{constructor(t,...a){if(0===arguments.length)throw new Error('Invalid arguments, try `new WeDeploy(baseUrl, url)`');this.auth_=null,this.body_=null,this.url_=Uri.joinPaths(t||'',...a),this.headers_=new MultiMap,this.params_=new MultiMap,this.withCredentials_=!0,this.header('Content-Type','application/json'),this.header('X-Requested-With','XMLHttpRequest')}static data(t){assertUriWithNoPath(t,'The data url should not have a path'),isString(t)&&(WeDeploy$1.dataUrl_=t);let a=new DataApiHelper(WeDeploy$1);return a.auth(WeDeploy$1.auth().currentUser),a}auth(t,a){return this.auth_=t,this.auth_ instanceof Auth||(this.auth_=Auth.create(t,a)),this}static auth(t){return isString(t)&&(WeDeploy$1.authUrl_=t),WeDeploy$1.auth_||(WeDeploy$1.auth_=new AuthApiHelper(WeDeploy$1)),WeDeploy$1.auth_}body(t){return this.body_=t,this}convertBodyToParams_(t,a){isString(a)?a={body:a}:a instanceof Embodied&&(a=a.body()),Object.keys(a||{}).forEach(n=>t.param(n,a[n]))}createClientRequest_(t,a){const n=new ClientRequest;return n.body(a||this.body_),!isDefAndNotNull(n.body())&&this.formData_&&n.body(this.formData_),n.method(t),n.headers(this.headers()),n.params(this.params()),n.url(this.url()),n.withCredentials(this.withCredentials_),this.encode(n),n}decode(t){if(WeDeploy$1.isContentTypeJson(t))try{t.body(JSON.parse(t.body()))}catch(a){}return t}delete(t){return this.sendAsync('DELETE',t)}encode(t){let a=t.body();return isElement(a)&&(a=new FormData(a),t.body(a)),a=this.maybeWrapWithQuery_(a),'GET'===t.method()&&(this.convertBodyToParams_(t,a),t.removeBody(),a=null),'undefined'!=typeof FormData&&a instanceof FormData?t.headers().remove('content-type'):a instanceof Embodied?t.body(a.toString()):WeDeploy$1.isContentTypeJson(t)&&t.body(JSON.stringify(t.body())),this.encodeParams_(t),this.resolveAuthentication_(t),t}encodeParams_(t){let a=t.params();a.names().forEach(function(n){let r=a.getAll(n);r.forEach(function(o,d){o instanceof Embodied?o=o.toString():(isObject(o)||o instanceof Array)&&(o=JSON.stringify(o)),r[d]=o})})}form(t,a){if('undefined'==typeof FormData)throw new Error('form() is only available when FormData API is available.');return this.formData_||(this.formData_=new FormData),this.formData_.append(t,a),this}get(t){return this.sendAsync('GET',t)}header(t,a){if(2!==arguments.length)throw new Error('Invalid arguments');return this.headers_.set(t,a),this}headers(){return this.headers_}maybeWrapWithQuery_(t){return t instanceof Filter&&(t=Query.filter(t)),t}param(t,a){if(2!==arguments.length)throw new Error('Invalid arguments');return this.params_.set(t,a),this}params(){return this.params_}patch(t){return this.sendAsync('PATCH',t)}path(...t){return new WeDeploy$1(this.url(),...t).use(this.customTransport_)}post(t){return this.sendAsync('POST',t)}put(t){return this.sendAsync('PUT',t)}resolveAuthentication_(t){if(this.auth_)if(this.auth_.hasToken())t.header('Authorization','Bearer '+this.auth_.token);else{const a=this.auth_.email+':'+this.auth_.password;t.header('Authorization','Basic '+Base64.encodeString(a))}}sendAsync(t,a){const n=this.customTransport_||TransportFactory.instance().getDefault(),r=this.createClientRequest_(t,a);return n.send(r).then(this.decode)}static socket(t){io=t}static url(t){return new WeDeploy$1(t).use(this.customTransport_)}url(){return this.url_}use(t){return this.customTransport_=t,this}watch(t,a){if('undefined'==typeof io)throw new Error('Socket.io client not loaded');const n=this.createClientRequest_('GET',t),r=new Uri(n.url());return r.addParametersFromMultiMap(n.params()),a=a||{forceNew:!0},a.query='url='+encodeURIComponent(r.getPathname()+r.getSearch()),a.path=a.path||r.getPathname(),io(r.getHost(),a)}withCredentials(t){return this.withCredentials_=!!t,this}}WeDeploy$1.isContentTypeJson=function(t){const a=t.headers().get('content-type')||'';return 0===a.indexOf('application/json')},WeDeploy$1.auth_=null,WeDeploy$1.authUrl_='',WeDeploy$1.data_=null,WeDeploy$1.dataUrl_='',globals.window.Filter=Filter,globals.window.Geo=Geo,globals.window.Query=Query,globals.window.Range=Range,globals.window.WeDeploy=WeDeploy$1;export{Filter,Geo,Query,Range,WeDeploy$1 as WeDeploy};export default WeDeploy$1;