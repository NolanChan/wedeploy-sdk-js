(function(_){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=_();else if("function"==typeof define&&define.amd)define([],_);else{var k;k="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,k.io=_()}})(function(){var _;return function k(C,E,A){function S(N,R){if(!E[N]){if(!C[N]){var P="function"==typeof require&&require;if(!R&&P)return P(N,!0);if(w)return w(N,!0);var T=new Error("Cannot find module '"+N+"'");throw T.code="MODULE_NOT_FOUND",T}var O=E[N]={exports:{}};C[N][0].call(O.exports,function(B){var U=C[N][1][B];return S(U?U:B)},O,O.exports,k,C,E,A)}return E[N].exports}var w="function"==typeof require&&require;for(var D=0;D<A.length;D++)S(A[D]);return S}({1:[function(k,C,E){function A(P,T){"object"==typeof P&&(T=P,P=void 0),T=T||{};var O=S(P),B=O.source,U=O.id,I=O.path,L=R[U]&&I in R[U].nsps,q=T.forceNew||T["force new connection"]||!1===T.multiplex||L,M;return q?(N("ignoring socket cache for %s",B),M=D(B,T)):(!R[U]&&(N("new io instance for %s",B),R[U]=D(B,T)),M=R[U]),M.socket(O.path)}var S=k("./url"),w=k("socket.io-parser"),D=k("./manager"),N=k("debug")("socket.io-client");C.exports=E=A;var R=E.managers={};E.protocol=w.protocol,E.connect=A,E.Manager=k("./manager"),E.Socket=k("./socket")},{"./manager":2,"./socket":4,"./url":5,debug:14,"socket.io-parser":40}],2:[function(k,C,E){function A(I,L){return this instanceof A?void(I&&"object"==typeof I&&(L=I,I=void 0),L=L||{},L.path=L.path||"/socket.io",this.nsps={},this.subs=[],this.opts=L,this.reconnection(!1!==L.reconnection),this.reconnectionAttempts(L.reconnectionAttempts||1/0),this.reconnectionDelay(L.reconnectionDelay||1000),this.reconnectionDelayMax(L.reconnectionDelayMax||5000),this.randomizationFactor(L.randomizationFactor||0.5),this.backoff=new B({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==L.timeout?20000:L.timeout),this.readyState="closed",this.uri=I,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new N.Encoder,this.decoder=new N.Decoder,this.autoConnect=!1!==L.autoConnect,this.autoConnect&&this.open()):new A(I,L)}var S=k("engine.io-client"),w=k("./socket"),D=k("component-emitter"),N=k("socket.io-parser"),R=k("./on"),P=k("component-bind"),T=k("debug")("socket.io-client:manager"),O=k("indexof"),B=k("backo2"),U=Object.prototype.hasOwnProperty;C.exports=A,A.prototype.emitAll=function(){for(var I in this.emit.apply(this,arguments),this.nsps)U.call(this.nsps,I)&&this.nsps[I].emit.apply(this.nsps[I],arguments)},A.prototype.updateSocketIds=function(){for(var I in this.nsps)U.call(this.nsps,I)&&(this.nsps[I].id=this.engine.id)},D(A.prototype),A.prototype.reconnection=function(I){return arguments.length?(this._reconnection=!!I,this):this._reconnection},A.prototype.reconnectionAttempts=function(I){return arguments.length?(this._reconnectionAttempts=I,this):this._reconnectionAttempts},A.prototype.reconnectionDelay=function(I){return arguments.length?(this._reconnectionDelay=I,this.backoff&&this.backoff.setMin(I),this):this._reconnectionDelay},A.prototype.randomizationFactor=function(I){return arguments.length?(this._randomizationFactor=I,this.backoff&&this.backoff.setJitter(I),this):this._randomizationFactor},A.prototype.reconnectionDelayMax=function(I){return arguments.length?(this._reconnectionDelayMax=I,this.backoff&&this.backoff.setMax(I),this):this._reconnectionDelayMax},A.prototype.timeout=function(I){return arguments.length?(this._timeout=I,this):this._timeout},A.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},A.prototype.open=A.prototype.connect=function(I){if(T("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;T("opening %s",this.uri),this.engine=S(this.uri,this.opts);var L=this.engine,q=this;this.readyState="opening",this.skipReconnect=!1;var M=R(L,"open",function(){q.onopen(),I&&I()}),F=R(L,"error",function(J){if(T("connect_error"),q.cleanup(),q.readyState="closed",q.emitAll("connect_error",J),I){var V=new Error("Connection error");V.data=J,I(V)}else q.maybeReconnectOnOpen()});if(!1!==this._timeout){var H=this._timeout;T("connect attempt will timeout after %d",H);var z=setTimeout(function(){T("connect attempt timed out after %d",H),M.destroy(),L.close(),L.emit("error","timeout"),q.emitAll("connect_timeout",H)},H);this.subs.push({destroy:function(){clearTimeout(z)}})}return this.subs.push(M),this.subs.push(F),this},A.prototype.onopen=function(){T("open"),this.cleanup(),this.readyState="open",this.emit("open");var I=this.engine;this.subs.push(R(I,"data",P(this,"ondata"))),this.subs.push(R(I,"ping",P(this,"onping"))),this.subs.push(R(I,"pong",P(this,"onpong"))),this.subs.push(R(I,"error",P(this,"onerror"))),this.subs.push(R(I,"close",P(this,"onclose"))),this.subs.push(R(this.decoder,"decoded",P(this,"ondecoded")))},A.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},A.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},A.prototype.ondata=function(I){this.decoder.add(I)},A.prototype.ondecoded=function(I){this.emit("packet",I)},A.prototype.onerror=function(I){T("error",I),this.emitAll("error",I)},A.prototype.socket=function(I){function L(){~O(M.connecting,q)||M.connecting.push(q)}var q=this.nsps[I];if(!q){q=new w(this,I),this.nsps[I]=q;var M=this;q.on("connecting",L),q.on("connect",function(){q.id=M.engine.id}),this.autoConnect&&L()}return q},A.prototype.destroy=function(I){var L=O(this.connecting,I);~L&&this.connecting.splice(L,1),this.connecting.length||this.close()},A.prototype.packet=function(I){T("writing packet %j",I);var L=this;L.encoding?L.packetBuffer.push(I):(L.encoding=!0,this.encoder.encode(I,function(q){for(var M=0;M<q.length;M++)L.engine.write(q[M],I.options);L.encoding=!1,L.processPacketQueue()}))},A.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var I=this.packetBuffer.shift();this.packet(I)}},A.prototype.cleanup=function(){T("cleanup");for(var I;I=this.subs.shift();)I.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},A.prototype.close=A.prototype.disconnect=function(){T("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},A.prototype.onclose=function(I){T("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",I),this._reconnection&&!this.skipReconnect&&this.reconnect()},A.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var I=this;if(this.backoff.attempts>=this._reconnectionAttempts)T("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var L=this.backoff.duration();T("will wait %dms before reconnect attempt",L),this.reconnecting=!0;var q=setTimeout(function(){I.skipReconnect||(T("attempting reconnect"),I.emitAll("reconnect_attempt",I.backoff.attempts),I.emitAll("reconnecting",I.backoff.attempts),!I.skipReconnect&&I.open(function(F){F?(T("reconnect attempt error"),I.reconnecting=!1,I.reconnect(),I.emitAll("reconnect_error",F.data)):(T("reconnect success"),I.onreconnect())}))},L);this.subs.push({destroy:function(){clearTimeout(q)}})}},A.prototype.onreconnect=function(){var I=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",I)}},{"./on":3,"./socket":4,backo2:8,"component-bind":11,"component-emitter":12,debug:14,"engine.io-client":16,indexof:32,"socket.io-parser":40}],3:[function(k,C,E){C.exports=function(S,w,D){return S.on(w,D),{destroy:function(){S.removeListener(w,D)}}}},{}],4:[function(k,C,E){function A(U,I){this.io=U,this.nsp=I,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var S=k("socket.io-parser"),w=k("component-emitter"),D=k("to-array"),N=k("./on"),R=k("component-bind"),P=k("debug")("socket.io-client:socket"),T=k("has-binary");C.exports=E=A;var O={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},B=w.prototype.emit;w(A.prototype),A.prototype.subEvents=function(){if(!this.subs){var U=this.io;this.subs=[N(U,"open",R(this,"onopen")),N(U,"packet",R(this,"onpacket")),N(U,"close",R(this,"onclose"))]}},A.prototype.open=A.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},A.prototype.send=function(){var U=D(arguments);return U.unshift("message"),this.emit.apply(this,U),this},A.prototype.emit=function(U){if(O.hasOwnProperty(U))return B.apply(this,arguments),this;var I=D(arguments),L=S.EVENT;T(I)&&(L=S.BINARY_EVENT);var q={type:L,data:I};return q.options={},q.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof I[I.length-1]&&(P("emitting packet with ack id %d",this.ids),this.acks[this.ids]=I.pop(),q.id=this.ids++),this.connected?this.packet(q):this.sendBuffer.push(q),delete this.flags,this},A.prototype.packet=function(U){U.nsp=this.nsp,this.io.packet(U)},A.prototype.onopen=function(){P("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:S.CONNECT})},A.prototype.onclose=function(U){P("close (%s)",U),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",U)},A.prototype.onpacket=function(U){if(U.nsp==this.nsp)switch(U.type){case S.CONNECT:this.onconnect();break;case S.EVENT:this.onevent(U);break;case S.BINARY_EVENT:this.onevent(U);break;case S.ACK:this.onack(U);break;case S.BINARY_ACK:this.onack(U);break;case S.DISCONNECT:this.ondisconnect();break;case S.ERROR:this.emit("error",U.data);}},A.prototype.onevent=function(U){var I=U.data||[];P("emitting event %j",I),null!=U.id&&(P("attaching ack callback to event"),I.push(this.ack(U.id))),this.connected?B.apply(this,I):this.receiveBuffer.push(I)},A.prototype.ack=function(U){var I=this,L=!1;return function(){if(!L){L=!0;var q=D(arguments);P("sending ack %j",q);var M=T(q)?S.BINARY_ACK:S.ACK;I.packet({type:M,id:U,data:q})}}},A.prototype.onack=function(U){var I=this.acks[U.id];"function"==typeof I?(P("calling ack %s with %j",U.id,U.data),I.apply(this,U.data),delete this.acks[U.id]):P("bad ack %s",U.id)},A.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},A.prototype.emitBuffered=function(){var U;for(U=0;U<this.receiveBuffer.length;U++)B.apply(this,this.receiveBuffer[U]);for(this.receiveBuffer=[],U=0;U<this.sendBuffer.length;U++)this.packet(this.sendBuffer[U]);this.sendBuffer=[]},A.prototype.ondisconnect=function(){P("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},A.prototype.destroy=function(){if(this.subs){for(var U=0;U<this.subs.length;U++)this.subs[U].destroy();this.subs=null}this.io.destroy(this)},A.prototype.close=A.prototype.disconnect=function(){return this.connected&&(P("performing disconnect (%s)",this.nsp),this.packet({type:S.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},A.prototype.compress=function(U){return this.flags=this.flags||{},this.flags.compress=U,this}},{"./on":3,"component-bind":11,"component-emitter":12,debug:14,"has-binary":30,"socket.io-parser":40,"to-array":43}],5:[function(k,C,E){(function(A){var S=k("parseuri"),w=k("debug")("socket.io-client:url");C.exports=function(N,R){var P=N,R=R||A.location;null==N&&(N=R.protocol+"//"+R.host),"string"==typeof N&&("/"==N.charAt(0)&&("/"==N.charAt(1)?N=R.protocol+N:N=R.host+N),!/^(https?|wss?):\/\//.test(N)&&(w("protocol-less url %s",N),N="undefined"==typeof R?"https://"+N:R.protocol+"//"+N),w("parse %s",N),P=S(N)),P.port||(/^(http|ws)$/.test(P.protocol)?P.port="80":/^(http|ws)s$/.test(P.protocol)&&(P.port="443")),P.path=P.path||"/";var T=-1!==P.host.indexOf(":"),O=T?"["+P.host+"]":P.host;return P.id=P.protocol+"://"+O+":"+P.port,P.href=P.protocol+"://"+O+(R&&R.port==P.port?"":":"+P.port),P}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{debug:14,parseuri:38}],6:[function(k,C,E){function A(){}C.exports=function(w,D,N){function R(T,O){if(0>=R.count)throw new Error("after called too many times");--R.count,T?(P=!0,D(T),D=N):0===R.count&&!P&&D(null,O)}var P=!1;return N=N||A,R.count=w,0===w?D():R}},{}],7:[function(k,C,E){C.exports=function(A,S,w){var D=A.byteLength;if(S=S||0,w=w||D,A.slice)return A.slice(S,w);if(0>S&&(S+=D),0>w&&(w+=D),w>D&&(w=D),S>=D||S>=w||0===D)return new ArrayBuffer(0);var N=new Uint8Array(A),R=new Uint8Array(w-S);for(var P=S,T=0;P<w;P++,T++)R[T]=N[P];return R.buffer}},{}],8:[function(k,C,E){function A(S){S=S||{},this.ms=S.min||100,this.max=S.max||10000,this.factor=S.factor||2,this.jitter=0<S.jitter&&1>=S.jitter?S.jitter:0,this.attempts=0}C.exports=A,A.prototype.duration=function(){var S=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var w=Math.random(),D=Math.floor(w*this.jitter*S);S=0==(1&Math.floor(10*w))?S-D:S+D}return 0|Math.min(S,this.max)},A.prototype.reset=function(){this.attempts=0},A.prototype.setMin=function(S){this.ms=S},A.prototype.setMax=function(S){this.max=S},A.prototype.setJitter=function(S){this.jitter=S}},{}],9:[function(k,C,E){(function(){"use strict";var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=new Uint8Array(256);for(var w=0;w<A.length;w++)S[A.charCodeAt(w)]=w;E.encode=function(D){var N=new Uint8Array(D),P=N.length,T="",R;for(R=0;R<P;R+=3)T+=A[N[R]>>2],T+=A[(3&N[R])<<4|N[R+1]>>4],T+=A[(15&N[R+1])<<2|N[R+2]>>6],T+=A[63&N[R+2]];return 2==P%3?T=T.substring(0,T.length-1)+"=":1==P%3&&(T=T.substring(0,T.length-2)+"=="),T},E.decode=function(D){var N=0.75*D.length,R=D.length,T=0,P,O,B,U,I;"="===D[D.length-1]&&(N--,"="===D[D.length-2]&&N--);var L=new ArrayBuffer(N),q=new Uint8Array(L);for(P=0;P<R;P+=4)O=S[D.charCodeAt(P)],B=S[D.charCodeAt(P+1)],U=S[D.charCodeAt(P+2)],I=S[D.charCodeAt(P+3)],q[T++]=O<<2|B>>4,q[T++]=(15&B)<<4|U>>2,q[T++]=(3&U)<<6|63&I;return L}})()},{}],10:[function(k,C,E){(function(A){function S(O){for(var B=0;B<O.length;B++){var U=O[B];if(U.buffer instanceof ArrayBuffer){var I=U.buffer;if(U.byteLength!==I.byteLength){var L=new Uint8Array(U.byteLength);L.set(new Uint8Array(I,U.byteOffset,U.byteLength)),I=L.buffer}O[B]=I}}}function w(O,B){B=B||{};var U=new N;S(O);for(var I=0;I<O.length;I++)U.append(O[I]);return B.type?U.getBlob(B.type):U.getBlob()}function D(O,B){return S(O),new Blob(O,B||{})}var N=A.BlobBuilder||A.WebKitBlobBuilder||A.MSBlobBuilder||A.MozBlobBuilder,R=function(){try{var O=new Blob(["hi"]);return 2===O.size}catch(B){return!1}}(),P=R&&function(){try{var O=new Blob([new Uint8Array([1,2])]);return 2===O.size}catch(B){return!1}}(),T=N&&N.prototype.append&&N.prototype.getBlob;;;C.exports=function(){if(R)return P?A.Blob:D;return T?w:void 0}()}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{}],11:[function(k,C,E){var A=[].slice;C.exports=function(S,w){if("string"==typeof w&&(w=S[w]),"function"!=typeof w)throw new Error("bind() requires a function");var D=A.call(arguments,2);return function(){return w.apply(S,D.concat(A.call(arguments)))}}},{}],12:[function(k,C,E){function A(w){if(w)return S(w)}function S(w){for(var D in A.prototype)w[D]=A.prototype[D];return w}C.exports=A;;A.prototype.on=A.prototype.addEventListener=function(w,D){return this._callbacks=this._callbacks||{},(this._callbacks["$"+w]=this._callbacks["$"+w]||[]).push(D),this},A.prototype.once=function(w,D){function N(){this.off(w,N),D.apply(this,arguments)}return N.fn=D,this.on(w,N),this},A.prototype.off=A.prototype.removeListener=A.prototype.removeAllListeners=A.prototype.removeEventListener=function(w,D){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var N=this._callbacks["$"+w];if(!N)return this;if(1==arguments.length)return delete this._callbacks["$"+w],this;var R;for(var P=0;P<N.length;P++)if(R=N[P],R===D||R.fn===D){N.splice(P,1);break}return this},A.prototype.emit=function(w){this._callbacks=this._callbacks||{};var D=[].slice.call(arguments,1),N=this._callbacks["$"+w];if(N){N=N.slice(0);for(var R=0,P=N.length;R<P;++R)N[R].apply(this,D)}return this},A.prototype.listeners=function(w){return this._callbacks=this._callbacks||{},this._callbacks["$"+w]||[]},A.prototype.hasListeners=function(w){return!!this.listeners(w).length}},{}],13:[function(k,C,E){C.exports=function(A,S){var w=function(){};w.prototype=S.prototype,A.prototype=new w,A.prototype.constructor=A}},{}],14:[function(k,C,E){function A(){var S;try{S=E.storage.debug}catch(w){}return S}E=C.exports=k("./debug"),E.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},E.formatArgs=function(){var w=arguments,D=this.useColors;if(w[0]=(D?"%c":"")+this.namespace+(D?" %c":" ")+w[0]+(D?"%c ":" ")+"+"+E.humanize(this.diff),!D)return w;var N="color: "+this.color;w=[w[0],N,"color: inherit"].concat(Array.prototype.slice.call(w,1));var R=0,P=0;return w[0].replace(/%[a-z%]/g,function(T){"%%"===T||(R++,"%c"===T&&(P=R))}),w.splice(P,0,N),w},E.save=function(w){try{null==w?E.storage.removeItem("debug"):E.storage.debug=w}catch(D){}},E.load=A,E.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},E.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(w){}}(),E.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],E.formatters.j=function(S){return JSON.stringify(S)},E.enable(A())},{"./debug":15}],15:[function(k,C,E){function A(){return E.colors[S++%E.colors.length]}E=C.exports=function(N){function R(){}function P(){var O=P,B=+new Date,U=B-(w||B);O.diff=U,O.prev=w,O.curr=B,w=B,null==O.useColors&&(O.useColors=E.useColors()),null==O.color&&O.useColors&&(O.color=A());var I=Array.prototype.slice.call(arguments);I[0]=E.coerce(I[0]),"string"!=typeof I[0]&&(I=["%o"].concat(I));var L=0;I[0]=I[0].replace(/%([a-z%])/g,function(M,F){if("%%"===M)return M;L++;var H=E.formatters[F];if("function"==typeof H){var z=I[L];M=H.call(O,z),I.splice(L,1),L--}return M}),"function"==typeof E.formatArgs&&(I=E.formatArgs.apply(O,I));var q=P.log||E.log||console.log.bind(console);q.apply(O,I)}R.enabled=!1,P.enabled=!0;var T=E.enabled(N)?P:R;return T.namespace=N,T},E.coerce=function(N){return N instanceof Error?N.stack||N.message:N},E.disable=function(){E.enable("")},E.enable=function(N){E.save(N);var R=(N||"").split(/[\s,]+/),P=R.length;for(var T=0;T<P;T++)R[T]&&(N=R[T].replace(/\*/g,".*?"),"-"===N[0]?E.skips.push(new RegExp("^"+N.substr(1)+"$")):E.names.push(new RegExp("^"+N+"$")))},E.enabled=function(N){var R,P;for(R=0,P=E.skips.length;R<P;R++)if(E.skips[R].test(N))return!1;for(R=0,P=E.names.length;R<P;R++)if(E.names[R].test(N))return!0;return!1},E.humanize=k("ms"),E.names=[],E.skips=[],E.formatters={};var S=0,w},{ms:35}],16:[function(k,C,E){C.exports=k("./lib/")},{"./lib/":17}],17:[function(k,C,E){C.exports=k("./socket"),C.exports.parser=k("engine.io-parser")},{"./socket":18,"engine.io-parser":27}],18:[function(k,C,E){(function(A){function S(I,L){if(!(this instanceof S))return new S(I,L);L=L||{},I&&"object"==typeof I&&(L=I,I=null),I?(I=O(I),L.hostname=I.host,L.secure="https"==I.protocol||"wss"==I.protocol,L.port=I.port,I.query&&(L.query=I.query)):L.host&&(L.hostname=O(L.host).host),this.secure=null==L.secure?A.location&&"https:"==location.protocol:L.secure,L.hostname&&!L.port&&(L.port=this.secure?"443":"80"),this.agent=L.agent||!1,this.hostname=L.hostname||(A.location?location.hostname:"localhost"),this.port=L.port||(A.location&&location.port?location.port:this.secure?443:80),this.query=L.query||{},"string"==typeof this.query&&(this.query=U.decode(this.query)),this.upgrade=!1!==L.upgrade,this.path=(L.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!L.forceJSONP,this.jsonp=!1!==L.jsonp,this.forceBase64=!!L.forceBase64,this.enablesXDR=!!L.enablesXDR,this.timestampParam=L.timestampParam||"t",this.timestampRequests=L.timestampRequests,this.transports=L.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=L.policyPort||843,this.rememberUpgrade=L.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=L.onlyBinaryUpgrades,this.perMessageDeflate=!1!==L.perMessageDeflate&&(L.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=L.pfx||null,this.key=L.key||null,this.passphrase=L.passphrase||null,this.cert=L.cert||null,this.ca=L.ca||null,this.ciphers=L.ciphers||null,this.rejectUnauthorized=!(L.rejectUnauthorized!==void 0)||L.rejectUnauthorized;var q="object"==typeof A&&A;q.global===q&&L.extraHeaders&&0<Object.keys(L.extraHeaders).length&&(this.extraHeaders=L.extraHeaders),this.open()}function w(I){var L={};for(var q in I)I.hasOwnProperty(q)&&(L[q]=I[q]);return L}var D=k("./transports"),N=k("component-emitter"),R=k("debug")("engine.io-client:socket"),P=k("indexof"),T=k("engine.io-parser"),O=k("parseuri"),B=k("parsejson"),U=k("parseqs");C.exports=S,S.priorWebsocketSuccess=!1,N(S.prototype),S.protocol=T.protocol,S.Socket=S,S.Transport=k("./transport"),S.transports=k("./transports"),S.parser=k("engine.io-parser"),S.prototype.createTransport=function(I){R("creating transport \"%s\"",I);var L=w(this.query);L.EIO=T.protocol,L.transport=I,this.id&&(L.sid=this.id);var q=new D[I]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:L,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return q},S.prototype.open=function(){var I;if(this.rememberUpgrade&&S.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))I="websocket";else{if(0===this.transports.length){var L=this;return void setTimeout(function(){L.emit("error","No transports available")},0)}I=this.transports[0]}this.readyState="opening";try{I=this.createTransport(I)}catch(q){return this.transports.shift(),void this.open()}I.open(),this.setTransport(I)},S.prototype.setTransport=function(I){R("setting transport %s",I.name);var L=this;this.transport&&(R("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=I,I.on("drain",function(){L.onDrain()}).on("packet",function(q){L.onPacket(q)}).on("error",function(q){L.onError(q)}).on("close",function(){L.onClose("transport close")})},S.prototype.probe=function(I){function L(){if(Q.onlyBinaryUpgrades){var W=!this.supportsBinary&&Q.transport.supportsBinary;Y=Y||W}Y||(R("probe transport \"%s\" opened",I),V.send([{type:"ping",data:"probe"}]),V.once("packet",function(G){if(!Y)if("pong"==G.type&&"probe"==G.data){if(R("probe transport \"%s\" pong",I),Q.upgrading=!0,Q.emit("upgrading",V),!V)return;S.priorWebsocketSuccess="websocket"==V.name,R("pausing current transport \"%s\"",Q.transport.name),Q.transport.pause(function(){Y||"closed"==Q.readyState||(R("changing transport and sending upgrade packet"),J(),Q.setTransport(V),V.send([{type:"upgrade"}]),Q.emit("upgrade",V),V=null,Q.upgrading=!1,Q.flush())})}else{R("probe transport \"%s\" failed",I);var $=new Error("probe error");$.transport=V.name,Q.emit("upgradeError",$)}}))}function q(){Y||(Y=!0,J(),V.close(),V=null)}function M(W){var X=new Error("probe error: "+W);X.transport=V.name,q(),R("probe transport \"%s\" failed because of error: %s",I,W),Q.emit("upgradeError",X)}function F(){M("transport closed")}function H(){M("socket closed")}function z(W){V&&W.name!=V.name&&(R("\"%s\" works - aborting \"%s\"",W.name,V.name),q())}function J(){V.removeListener("open",L),V.removeListener("error",M),V.removeListener("close",F),Q.removeListener("close",H),Q.removeListener("upgrading",z)}R("probing transport \"%s\"",I);var V=this.createTransport(I,{probe:1}),Y=!1,Q=this;S.priorWebsocketSuccess=!1,V.once("open",L),V.once("error",M),V.once("close",F),this.once("close",H),this.once("upgrading",z),V.open()},S.prototype.onOpen=function(){if(R("socket open"),this.readyState="open",S.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){R("starting upgrade probes");for(var I=0,L=this.upgrades.length;I<L;I++)this.probe(this.upgrades[I])}},S.prototype.onPacket=function(I){if("opening"==this.readyState||"open"==this.readyState)switch(R("socket receive: type \"%s\", data \"%s\"",I.type,I.data),this.emit("packet",I),this.emit("heartbeat"),I.type){case"open":this.onHandshake(B(I.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var L=new Error("server error");L.code=I.data,this.onError(L);break;case"message":this.emit("data",I.data),this.emit("message",I.data);}else R("packet received with socket readyState \"%s\"",this.readyState)},S.prototype.onHandshake=function(I){this.emit("handshake",I),this.id=I.sid,this.transport.query.sid=I.sid,this.upgrades=this.filterUpgrades(I.upgrades),this.pingInterval=I.pingInterval,this.pingTimeout=I.pingTimeout,this.onOpen(),"closed"==this.readyState||(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},S.prototype.onHeartbeat=function(I){clearTimeout(this.pingTimeoutTimer);var L=this;L.pingTimeoutTimer=setTimeout(function(){"closed"==L.readyState||L.onClose("ping timeout")},I||L.pingInterval+L.pingTimeout)},S.prototype.setPing=function(){var I=this;clearTimeout(I.pingIntervalTimer),I.pingIntervalTimer=setTimeout(function(){R("writing ping packet - expecting pong within %sms",I.pingTimeout),I.ping(),I.onHeartbeat(I.pingTimeout)},I.pingInterval)},S.prototype.ping=function(){var I=this;this.sendPacket("ping",function(){I.emit("ping")})},S.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},S.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(R("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},S.prototype.write=S.prototype.send=function(I,L,q){return this.sendPacket("message",I,L,q),this},S.prototype.sendPacket=function(I,L,q,M){if("function"==typeof L&&(M=L,L=void 0),"function"==typeof q&&(M=q,q=null),"closing"!=this.readyState&&"closed"!=this.readyState){q=q||{},q.compress=!1!==q.compress;var F={type:I,data:L,options:q};this.emit("packetCreate",F),this.writeBuffer.push(F),M&&this.once("flush",M),this.flush()}},S.prototype.close=function(){function I(){M.onClose("forced close"),R("socket closing - telling transport to close"),M.transport.close()}function L(){M.removeListener("upgrade",L),M.removeListener("upgradeError",L),I()}function q(){M.once("upgrade",L),M.once("upgradeError",L)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var M=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?q():I()}):this.upgrading?q():I()}return this},S.prototype.onError=function(I){R("socket error %j",I),S.priorWebsocketSuccess=!1,this.emit("error",I),this.onClose("transport error",I)},S.prototype.onClose=function(I,L){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){R("socket close with reason: \"%s\"",I);var q=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",I,L),q.writeBuffer=[],q.prevBufferLen=0}},S.prototype.filterUpgrades=function(I){var L=[];for(var q=0,M=I.length;q<M;q++)~P(this.transports,I[q])&&L.push(I[q]);return L}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./transport":19,"./transports":20,"component-emitter":26,debug:14,"engine.io-parser":27,indexof:32,parsejson:36,parseqs:37,parseuri:38}],19:[function(k,C,E){function A(D){this.path=D.path,this.hostname=D.hostname,this.port=D.port,this.secure=D.secure,this.query=D.query,this.timestampParam=D.timestampParam,this.timestampRequests=D.timestampRequests,this.readyState="",this.agent=D.agent||!1,this.socket=D.socket,this.enablesXDR=D.enablesXDR,this.pfx=D.pfx,this.key=D.key,this.passphrase=D.passphrase,this.cert=D.cert,this.ca=D.ca,this.ciphers=D.ciphers,this.rejectUnauthorized=D.rejectUnauthorized,this.extraHeaders=D.extraHeaders}var S=k("engine.io-parser"),w=k("component-emitter");C.exports=A,w(A.prototype),A.prototype.onError=function(D,N){var R=new Error(D);return R.type="TransportError",R.description=N,this.emit("error",R),this},A.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},A.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},A.prototype.send=function(D){if("open"==this.readyState)this.write(D);else throw new Error("Transport not open")},A.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},A.prototype.onData=function(D){var N=S.decodePacket(D,this.socket.binaryType);this.onPacket(N)},A.prototype.onPacket=function(D){this.emit("packet",D)},A.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":26,"engine.io-parser":27}],20:[function(k,C,E){(function(A){var S=k("xmlhttprequest-ssl"),w=k("./polling-xhr"),D=k("./polling-jsonp"),N=k("./websocket");E.polling=function(P){var O=!1,B=!1,U=!1!==P.jsonp,T;if(A.location){var I="https:"==location.protocol,L=location.port;L||(L=I?443:80),O=P.hostname!=location.hostname||L!=P.port,B=P.secure!=I}if(P.xdomain=O,P.xscheme=B,T=new S(P),"open"in T&&!P.forceJSONP)return new w(P);if(!U)throw new Error("JSONP disabled");return new D(P)},E.websocket=N}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./polling-jsonp":21,"./polling-xhr":22,"./websocket":24,"xmlhttprequest-ssl":25}],21:[function(k,C,E){(function(A){function S(){}function w(O){D.call(this,O),this.query=this.query||{},T||(!A.___eio&&(A.___eio=[]),T=A.___eio),this.index=T.length;var B=this;T.push(function(U){B.onData(U)}),this.query.j=this.index,A.document&&A.addEventListener&&A.addEventListener("beforeunload",function(){B.script&&(B.script.onerror=S)},!1)}var D=k("./polling"),N=k("component-inherit");C.exports=w;var R=/\n/g,P=/\\n/g,T;N(w,D),w.prototype.supportsBinary=!1,w.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),D.prototype.doClose.call(this)},w.prototype.doPoll=function(){var O=this,B=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),B.async=!0,B.src=this.uri(),B.onerror=function(L){O.onError("jsonp poll error",L)};var U=document.getElementsByTagName("script")[0];U?U.parentNode.insertBefore(B,U):(document.head||document.body).appendChild(B),this.script=B;var I="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);I&&setTimeout(function(){var L=document.createElement("iframe");document.body.appendChild(L),document.body.removeChild(L)},100)},w.prototype.doWrite=function(O,B){function U(){I(),B()}function I(){if(L.iframe)try{L.form.removeChild(L.iframe)}catch(J){L.onError("jsonp polling iframe removal error",J)}try{var z="<iframe src=\"javascript:0\" name=\""+L.iframeId+"\">";H=document.createElement(z)}catch(J){H=document.createElement("iframe"),H.name=L.iframeId,H.src="javascript:0"}H.id=L.iframeId,L.form.appendChild(H),L.iframe=H}var L=this;if(!this.form){var q=document.createElement("form"),M=document.createElement("textarea"),F=this.iframeId="eio_iframe_"+this.index,H;q.className="socketio",q.style.position="absolute",q.style.top="-1000px",q.style.left="-1000px",q.target=F,q.method="POST",q.setAttribute("accept-charset","utf-8"),M.name="d",q.appendChild(M),document.body.appendChild(q),this.form=q,this.area=M}this.form.action=this.uri(),I(),O=O.replace(P,"\\\n"),this.area.value=O.replace(R,"\\n");try{this.form.submit()}catch(z){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==L.iframe.readyState&&U()}:this.iframe.onload=U}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./polling":23,"component-inherit":13}],22:[function(k,C,E){(function(A){function S(){}function w(U){if(P.call(this,U),A.location){var I="https:"==location.protocol,L=location.port;L||(L=I?443:80),this.xd=U.hostname!=A.location.hostname||L!=U.port,this.xs=U.secure!=I}else this.extraHeaders=U.extraHeaders}function D(U){this.method=U.method||"GET",this.uri=U.uri,this.xd=!!U.xd,this.xs=!!U.xs,this.async=!1!==U.async,this.data=void 0==U.data?null:U.data,this.agent=U.agent,this.isBinary=U.isBinary,this.supportsBinary=U.supportsBinary,this.enablesXDR=U.enablesXDR,this.pfx=U.pfx,this.key=U.key,this.passphrase=U.passphrase,this.cert=U.cert,this.ca=U.ca,this.ciphers=U.ciphers,this.rejectUnauthorized=U.rejectUnauthorized,this.extraHeaders=U.extraHeaders,this.create()}function N(){for(var U in D.requests)D.requests.hasOwnProperty(U)&&D.requests[U].abort()}var R=k("xmlhttprequest-ssl"),P=k("./polling"),T=k("component-emitter"),O=k("component-inherit"),B=k("debug")("engine.io-client:polling-xhr");C.exports=w,C.exports.Request=D,O(w,P),w.prototype.supportsBinary=!0,w.prototype.request=function(U){return U=U||{},U.uri=this.uri(),U.xd=this.xd,U.xs=this.xs,U.agent=this.agent||!1,U.supportsBinary=this.supportsBinary,U.enablesXDR=this.enablesXDR,U.pfx=this.pfx,U.key=this.key,U.passphrase=this.passphrase,U.cert=this.cert,U.ca=this.ca,U.ciphers=this.ciphers,U.rejectUnauthorized=this.rejectUnauthorized,U.extraHeaders=this.extraHeaders,new D(U)},w.prototype.doWrite=function(U,I){var L="string"!=typeof U&&U!==void 0,q=this.request({method:"POST",data:U,isBinary:L}),M=this;q.on("success",I),q.on("error",function(F){M.onError("xhr post error",F)}),this.sendXhr=q},w.prototype.doPoll=function(){B("xhr poll");var U=this.request(),I=this;U.on("data",function(L){I.onData(L)}),U.on("error",function(L){I.onError("xhr poll error",L)}),this.pollXhr=U},T(D.prototype),D.prototype.create=function(){var U={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};U.pfx=this.pfx,U.key=this.key,U.passphrase=this.passphrase,U.cert=this.cert,U.ca=this.ca,U.ciphers=this.ciphers,U.rejectUnauthorized=this.rejectUnauthorized;var I=this.xhr=new R(U),L=this;try{B("xhr open %s: %s",this.method,this.uri),I.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var q in I.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(q)&&I.setRequestHeader(q,this.extraHeaders[q])}catch(M){}if(this.supportsBinary&&(I.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?I.setRequestHeader("Content-type","application/octet-stream"):I.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(M){}"withCredentials"in I&&(I.withCredentials=!0),this.hasXDR()?(I.onload=function(){L.onLoad()},I.onerror=function(){L.onError(I.responseText)}):I.onreadystatechange=function(){4==I.readyState&&(200==I.status||1223==I.status?L.onLoad():setTimeout(function(){L.onError(I.status)},0))},B("xhr data %s",this.data),I.send(this.data)}catch(M){return void setTimeout(function(){L.onError(M)},0)}A.document&&(this.index=D.requestsCount++,D.requests[this.index]=this)},D.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},D.prototype.onData=function(U){this.emit("data",U),this.onSuccess()},D.prototype.onError=function(U){this.emit("error",U),this.cleanup(!0)},D.prototype.cleanup=function(U){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=S:this.xhr.onreadystatechange=S,U)try{this.xhr.abort()}catch(I){}A.document&&delete D.requests[this.index],this.xhr=null}},D.prototype.onLoad=function(){var U;try{var I;try{I=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(H){}if("application/octet-stream"===I)U=this.xhr.response;else if(!this.supportsBinary)U=this.xhr.responseText;else try{U=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(H){var L=new Uint8Array(this.xhr.response),q=[];for(var M=0,F=L.length;M<F;M++)q.push(L[M]);U=String.fromCharCode.apply(null,q)}}catch(H){this.onError(H)}null!=U&&this.onData(U)},D.prototype.hasXDR=function(){return"undefined"!=typeof A.XDomainRequest&&!this.xs&&this.enablesXDR},D.prototype.abort=function(){this.cleanup()},A.document&&(D.requestsCount=0,D.requests={},A.attachEvent?A.attachEvent("onunload",N):A.addEventListener&&A.addEventListener("beforeunload",N,!1))}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./polling":23,"component-emitter":26,"component-inherit":13,debug:14,"xmlhttprequest-ssl":25}],23:[function(k,C,E){function A(O){var B=O&&O.forceBase64;(!T||B)&&(this.supportsBinary=!1),S.call(this,O)}var S=k("../transport"),w=k("parseqs"),D=k("engine.io-parser"),N=k("component-inherit"),R=k("yeast"),P=k("debug")("engine.io-client:polling");C.exports=A;var T=function(){var O=k("xmlhttprequest-ssl"),B=new O({xdomain:!1});return null!=B.responseType}();N(A,S),A.prototype.name="polling",A.prototype.doOpen=function(){this.poll()},A.prototype.pause=function(O){function B(){P("paused"),U.readyState="paused",O()}var U=this;if(this.readyState="pausing",this.polling||!this.writable){var I=0;this.polling&&(P("we are currently polling - waiting to pause"),I++,this.once("pollComplete",function(){P("pre-pause polling complete"),--I||B()})),this.writable||(P("we are currently writing - waiting to pause"),I++,this.once("drain",function(){P("pre-pause writing complete"),--I||B()}))}else B()},A.prototype.poll=function(){P("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},A.prototype.onData=function(O){var B=this;P("polling got data %s",O),D.decodePayload(O,this.socket.binaryType,function(U,I,L){return"opening"==B.readyState&&B.onOpen(),"close"==U.type?(B.onClose(),!1):void B.onPacket(U)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():P("ignoring poll - transport state \"%s\"",this.readyState))},A.prototype.doClose=function(){function O(){P("writing close packet"),B.write([{type:"close"}])}var B=this;"open"==this.readyState?(P("transport open - closing"),O()):(P("transport not open - deferring close"),this.once("open",O))},A.prototype.write=function(O){var B=this;this.writable=!1;var U=function(){B.writable=!0,B.emit("drain")},B=this;D.encodePayload(O,this.supportsBinary,function(I){B.doWrite(I,U)})},A.prototype.uri=function(){var O=this.query||{},B=this.secure?"https":"http",U="";!1!==this.timestampRequests&&(O[this.timestampParam]=R()),this.supportsBinary||O.sid||(O.b64=1),O=w.encode(O),this.port&&("https"==B&&443!=this.port||"http"==B&&80!=this.port)&&(U=":"+this.port),O.length&&(O="?"+O);var I=-1!==this.hostname.indexOf(":");return B+"://"+(I?"["+this.hostname+"]":this.hostname)+U+this.path+O}},{"../transport":19,"component-inherit":13,debug:14,"engine.io-parser":27,parseqs:37,"xmlhttprequest-ssl":25,yeast:45}],24:[function(k,C,E){(function(A){function S(U){var I=U&&U.forceBase64;I&&(this.supportsBinary=!1),this.perMessageDeflate=U.perMessageDeflate,w.call(this,U)}var w=k("../transport"),D=k("engine.io-parser"),N=k("parseqs"),R=k("component-inherit"),P=k("yeast"),T=k("debug")("engine.io-client:websocket"),O=A.WebSocket||A.MozWebSocket,B=O;if(!B&&"undefined"==typeof window)try{B=k("ws")}catch(U){}C.exports=S,R(S,w),S.prototype.name="websocket",S.prototype.supportsBinary=!0,S.prototype.doOpen=function(){if(this.check()){this;var U=this.uri(),I={agent:this.agent,perMessageDeflate:this.perMessageDeflate};I.pfx=this.pfx,I.key=this.key,I.passphrase=this.passphrase,I.cert=this.cert,I.ca=this.ca,I.ciphers=this.ciphers,I.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(I.headers=this.extraHeaders),this.ws=O?new B(U):new B(U,void 0,I),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},S.prototype.addEventListeners=function(){var U=this;this.ws.onopen=function(){U.onOpen()},this.ws.onclose=function(){U.onClose()},this.ws.onmessage=function(I){U.onData(I.data)},this.ws.onerror=function(I){U.onError("websocket error",I)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(S.prototype.onData=function(U){var I=this;setTimeout(function(){w.prototype.onData.call(I,U)},0)}),S.prototype.write=function(U){function I(){L.emit("flush"),setTimeout(function(){L.writable=!0,L.emit("drain")},0)}var L=this;this.writable=!1;var q=U.length;for(var M=0,F=q;M<F;M++)(function(H){D.encodePacket(H,L.supportsBinary,function(z){if(!O){var J={};if(H.options&&(J.compress=H.options.compress),L.perMessageDeflate){var V="string"==typeof z?A.Buffer.byteLength(z):z.length;V<L.perMessageDeflate.threshold&&(J.compress=!1)}}try{O?L.ws.send(z):L.ws.send(z,J)}catch(Y){T("websocket closed before onclose event")}--q||I()})})(U[M])},S.prototype.onClose=function(){w.prototype.onClose.call(this)},S.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},S.prototype.uri=function(){var U=this.query||{},I=this.secure?"wss":"ws",L="";this.port&&("wss"==I&&443!=this.port||"ws"==I&&80!=this.port)&&(L=":"+this.port),this.timestampRequests&&(U[this.timestampParam]=P()),this.supportsBinary||(U.b64=1),U=N.encode(U),U.length&&(U="?"+U);var q=-1!==this.hostname.indexOf(":");return I+"://"+(q?"["+this.hostname+"]":this.hostname)+L+this.path+U},S.prototype.check=function(){return!!B&&!("__initialize"in B&&this.name===S.prototype.name)}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"../transport":19,"component-inherit":13,debug:14,"engine.io-parser":27,parseqs:37,ws:void 0,yeast:45}],25:[function(k,C,E){var A=k("has-cors");C.exports=function(S){var w=S.xdomain,D=S.xscheme,N=S.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!w||A))return new XMLHttpRequest}catch(R){}try{if("undefined"!=typeof XDomainRequest&&!D&&N)return new XDomainRequest}catch(R){}if(!w)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(R){}}},{"has-cors":31}],26:[function(k,C,E){function A(w){if(w)return S(w)}function S(w){for(var D in A.prototype)w[D]=A.prototype[D];return w}C.exports=A;;A.prototype.on=A.prototype.addEventListener=function(w,D){return this._callbacks=this._callbacks||{},(this._callbacks[w]=this._callbacks[w]||[]).push(D),this},A.prototype.once=function(w,D){function N(){R.off(w,N),D.apply(this,arguments)}var R=this;return this._callbacks=this._callbacks||{},N.fn=D,this.on(w,N),this},A.prototype.off=A.prototype.removeListener=A.prototype.removeAllListeners=A.prototype.removeEventListener=function(w,D){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var N=this._callbacks[w];if(!N)return this;if(1==arguments.length)return delete this._callbacks[w],this;var R;for(var P=0;P<N.length;P++)if(R=N[P],R===D||R.fn===D){N.splice(P,1);break}return this},A.prototype.emit=function(w){this._callbacks=this._callbacks||{};var D=[].slice.call(arguments,1),N=this._callbacks[w];if(N){N=N.slice(0);for(var R=0,P=N.length;R<P;++R)N[R].apply(this,D)}return this},A.prototype.listeners=function(w){return this._callbacks=this._callbacks||{},this._callbacks[w]||[]},A.prototype.hasListeners=function(w){return!!this.listeners(w).length}},{}],27:[function(k,C,E){(function(A){function S(V,Y){var Q="b"+E.packets[V.type]+V.data.data;return Y(Q)}function w(V,Y,Q){if(!Y)return E.encodeBase64Packet(V,Q);var W=V.data,X=new Uint8Array(W),K=new Uint8Array(1+W.byteLength);K[0]=F[V.type];for(var G=0;G<X.length;G++)K[G+1]=X[G];return Q(K.buffer)}function D(V,Y,Q){if(!Y)return E.encodeBase64Packet(V,Q);var W=new FileReader;return W.onload=function(){V.data=W.result,E.encodePacket(V,Y,!0,Q)},W.readAsArrayBuffer(V.data)}function N(V,Y,Q){if(!Y)return E.encodeBase64Packet(V,Q);if(M)return D(V,Y,Q);var W=new Uint8Array(1);W[0]=F[V.type];var X=new J([W.buffer,V.data]);return Q(X)}function R(V,Y,Q){var W=Array(V.length),X=U(V.length,Q),K=function($,Z,ee){Y(Z,function(te,oe){W[$]=oe,ee(te,W)})};for(var G=0;G<V.length;G++)K(G,V[G],X)}var P=k("./keys"),T=k("has-binary"),O=k("arraybuffer.slice"),B=k("base64-arraybuffer"),U=k("after"),I=k("utf8"),L=navigator.userAgent.match(/Android/i),q=/PhantomJS/i.test(navigator.userAgent),M=L||q;E.protocol=3;var F=E.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},H=P(F),z={type:"error",data:"parser error"},J=k("blob");E.encodePacket=function(V,Y,Q,W){"function"==typeof Y&&(W=Y,Y=!1),"function"==typeof Q&&(W=Q,Q=null);var X=void 0===V.data?void 0:V.data.buffer||V.data;if(A.ArrayBuffer&&X instanceof ArrayBuffer)return w(V,Y,W);if(J&&X instanceof A.Blob)return N(V,Y,W);if(X&&X.base64)return S(V,W);var K=F[V.type];return void 0!==V.data&&(K+=Q?I.encode(V.data+""):V.data+""),W(""+K)},E.encodeBase64Packet=function(V,Y){var Q="b"+E.packets[V.type];if(J&&V.data instanceof A.Blob){var W=new FileReader;return W.onload=function(){var Z=W.result.split(",")[1];Y(Q+Z)},W.readAsDataURL(V.data)}var X;try{X=String.fromCharCode.apply(null,new Uint8Array(V.data))}catch(Z){var K=new Uint8Array(V.data),G=Array(K.length);for(var $=0;$<K.length;$++)G[$]=K[$];X=String.fromCharCode.apply(null,G)}return Q+=A.btoa(X),Y(Q)},E.decodePacket=function(V,Y,Q){if("string"==typeof V||void 0===V){if("b"==V.charAt(0))return E.decodeBase64Packet(V.substr(1),Y);if(Q)try{V=I.decode(V)}catch(G){return z}var W=V.charAt(0);return+W==W&&H[W]?1<V.length?{type:H[W],data:V.substring(1)}:{type:H[W]}:z}var X=new Uint8Array(V),W=X[0],K=O(V,1);return J&&"blob"===Y&&(K=new J([K])),{type:H[W],data:K}},E.decodeBase64Packet=function(V,Y){var Q=H[V.charAt(0)];if(!A.ArrayBuffer)return{type:Q,data:{base64:!0,data:V.substr(1)}};var W=B.decode(V.substr(1));return"blob"===Y&&J&&(W=new J([W])),{type:Q,data:W}},E.encodePayload=function(V,Y,Q){function W(K){return K.length+":"+K}"function"==typeof Y&&(Q=Y,Y=null);var X=T(V);return Y&&X?J&&!M?E.encodePayloadAsBlob(V,Q):E.encodePayloadAsArrayBuffer(V,Q):V.length?void R(V,function(G,$){E.encodePacket(G,!!X&&Y,!0,function(Z){$(null,W(Z))})},function(K,G){return Q(G.join(""))}):Q("0:")},E.decodePayload=function(V,Y,Q){if("string"!=typeof V)return E.decodePayloadAsBinary(V,Y,Q);"function"==typeof Y&&(Q=Y,Y=null);var W;if(""==V)return Q(z,0,1);var X="",K,G;for(var $=0,Z=V.length;$<Z;$++){var ee=V.charAt($);if(":"!=ee)X+=ee;else{if(""==X||X!=(K=+X))return Q(z,0,1);if(G=V.substr($+1,K),X!=G.length)return Q(z,0,1);if(G.length){if(W=E.decodePacket(G,Y,!0),z.type==W.type&&z.data==W.data)return Q(z,0,1);var te=Q(W,$+K,Z);if(!1===te)return}$+=K,X=""}}if(""!=X)return Q(z,0,1)},E.encodePayloadAsArrayBuffer=function(V,Y){return V.length?void R(V,function(W,X){E.encodePacket(W,!0,!0,function(K){return X(null,K)})},function(Q,W){var X=W.reduce(function($,Z){var ee;return ee="string"==typeof Z?Z.length:Z.byteLength,$+ee.toString().length+ee+2},0),K=new Uint8Array(X),G=0;return W.forEach(function($){var Z="string"==typeof $,ee=$;if(Z){var te=new Uint8Array($.length);for(var oe=0;oe<$.length;oe++)te[oe]=$.charCodeAt(oe);ee=te.buffer}K[G++]=Z?0:1;var ne=ee.byteLength.toString();for(var oe=0;oe<ne.length;oe++)K[G++]=parseInt(ne[oe]);K[G++]=255;var te=new Uint8Array(ee);for(var oe=0;oe<te.length;oe++)K[G++]=te[oe]}),Y(K.buffer)}):Y(new ArrayBuffer(0))},E.encodePayloadAsBlob=function(V,Y){R(V,function(W,X){E.encodePacket(W,!0,!0,function(K){var G=new Uint8Array(1);if(G[0]=1,"string"==typeof K){var $=new Uint8Array(K.length);for(var Z=0;Z<K.length;Z++)$[Z]=K.charCodeAt(Z);K=$.buffer,G[0]=0}var ee=K instanceof ArrayBuffer?K.byteLength:K.size,te=ee.toString(),oe=new Uint8Array(te.length+1);for(var Z=0;Z<te.length;Z++)oe[Z]=parseInt(te[Z]);if(oe[te.length]=255,J){var ne=new J([G.buffer,oe.buffer,K]);X(null,ne)}})},function(Q,W){return Y(new J(W))})},E.decodePayloadAsBinary=function(V,Y,Q){"function"==typeof Y&&(Q=Y,Y=null);for(var W=V,X=[],K=!1;0<W.byteLength;){var G=new Uint8Array(W),$=0===G[0],Z="";for(var ee=1;;ee++){if(255==G[ee])break;if(310<Z.length){K=!0;break}Z+=G[ee]}if(K)return Q(z,0,1);W=O(W,2+Z.length),Z=parseInt(Z);var te=O(W,0,Z);if($)try{te=String.fromCharCode.apply(null,new Uint8Array(te))}catch(ae){var oe=new Uint8Array(te);te="";for(var ee=0;ee<oe.length;ee++)te+=String.fromCharCode(oe[ee])}X.push(te),W=O(W,Z)}var ne=X.length;X.forEach(function(ae,se){Q(E.decodePacket(ae,Y,!0),se,ne)})}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./keys":28,after:6,"arraybuffer.slice":7,"base64-arraybuffer":9,blob:10,"has-binary":29,utf8:44}],28:[function(k,C,E){C.exports=Object.keys||function(S){var w=[],D=Object.prototype.hasOwnProperty;for(var N in S)D.call(S,N)&&w.push(N);return w}},{}],29:[function(k,C,E){(function(A){var S=k("isarray");C.exports=function(D){function N(R){if(!R)return!1;if(A.Buffer&&A.Buffer.isBuffer(R)||A.ArrayBuffer&&R instanceof ArrayBuffer||A.Blob&&R instanceof Blob||A.File&&R instanceof File)return!0;if(S(R)){for(var P=0;P<R.length;P++)if(N(R[P]))return!0;}else if(R&&"object"==typeof R)for(var T in R.toJSON&&(R=R.toJSON()),R)if(Object.prototype.hasOwnProperty.call(R,T)&&N(R[T]))return!0;return!1}return N(D)}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{isarray:33}],30:[function(k,C,E){(function(A){var S=k("isarray");C.exports=function(D){function N(R){if(!R)return!1;if(A.Buffer&&A.Buffer.isBuffer&&A.Buffer.isBuffer(R)||A.ArrayBuffer&&R instanceof ArrayBuffer||A.Blob&&R instanceof Blob||A.File&&R instanceof File)return!0;if(S(R)){for(var P=0;P<R.length;P++)if(N(R[P]))return!0;}else if(R&&"object"==typeof R)for(var T in R.toJSON&&"function"==typeof R.toJSON&&(R=R.toJSON()),R)if(Object.prototype.hasOwnProperty.call(R,T)&&N(R[T]))return!0;return!1}return N(D)}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{isarray:33}],31:[function(k,C,E){try{C.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(A){C.exports=!1}},{}],32:[function(k,C,E){var A=[].indexOf;C.exports=function(S,w){if(A)return S.indexOf(w);for(var D=0;D<S.length;++D)if(S[D]===w)return D;return-1}},{}],33:[function(k,C,E){C.exports=Array.isArray||function(A){return"[object Array]"==Object.prototype.toString.call(A)}},{}],34:[function(k,C,E){(function(A){;(function(){function S(I,L){function q(Ee){if(q[Ee]!==$)return q[Ee];var Ae;if("bug-string-char-index"==Ee)Ae="a"!="a"[0];else if("json"==Ee)Ae=q("json-stringify")&&q("json-parse");else{var xe="{\"a\":[1,true,false,null,\"\\u0000\\b\\n\\f\\r\\t\"]}",Se;if("json-stringify"==Ee){var we=L.stringify,De="function"==typeof we&&Z;if(De){(Se=function(){return 1}).toJSON=Se;try{De="0"===we(0)&&"0"===we(new M)&&"\"\""==we(new F)&&we(X)===$&&we($)===$&&we()===$&&"1"===we(Se)&&"[1]"==we([Se])&&"[null]"==we([$])&&"null"==we(null)&&"[null,null,null]"==we([$,X,null])&&we({a:[Se,!0,!1,null,"\u0000\b\n\f\r\t"]})==xe&&"1"===we(null,Se)&&"[\n 1,\n 2\n]"==we([1,2],null,1)&&"\"-271821-04-20T00:00:00.000Z\""==we(new z(-8640000000000000))&&"\"+275760-09-13T00:00:00.000Z\""==we(new z(8640000000000000))&&"\"-000001-01-01T00:00:00.000Z\""==we(new z(-62198755200000))&&"\"1969-12-31T23:59:59.999Z\""==we(new z(-1))}catch(ve){De=!1}}Ae=De}if("json-parse"==Ee){var Ne=L.parse;if("function"==typeof Ne)try{if(0===Ne("0")&&!Ne(!1)){Se=Ne(xe);var Re=5==Se.a.length&&1===Se.a[0];if(Re){try{Re=!Ne("\"\t\"")}catch(ve){}if(Re)try{Re=1!==Ne("01")}catch(ve){}if(Re)try{Re=1!==Ne("1.")}catch(ve){}}}}catch(ve){Re=!1}Ae=Re}}return q[Ee]=!!Ae}I||(I=R.Object()),L||(L=R.Object());var M=I.Number||R.Number,F=I.String||R.String,H=I.Object||R.Object,z=I.Date||R.Date,J=I.SyntaxError||R.SyntaxError,V=I.TypeError||R.TypeError,Y=I.Math||R.Math,Q=I.JSON||R.JSON;"object"==typeof Q&&Q&&(L.stringify=Q.stringify,L.parse=Q.parse);var W=H.prototype,X=W.toString,Z=new z(-3509827334573292),K,G,$;try{Z=-109252==Z.getUTCFullYear()&&0===Z.getUTCMonth()&&1===Z.getUTCDate()&&10==Z.getUTCHours()&&37==Z.getUTCMinutes()&&6==Z.getUTCSeconds()&&708==Z.getUTCMilliseconds()}catch(Ee){}if(!q("json")){var ee="[object Function]",te="[object Number]",oe="[object String]",ne="[object Array]",ae=q("bug-string-char-index");if(!Z)var se=Y.floor,ie=[0,31,59,90,120,151,181,212,243,273,304,334],de=function(Ee,Ae){return ie[Ae]+365*(Ee-1970)+se((Ee-1969+(Ae=+(1<Ae)))/4)-se((Ee-1901+Ae)/100)+se((Ee-1601+Ae)/400)};if((K=W.hasOwnProperty)||(K=function(Ee){var Ae={},Se;return(Ae.__proto__=null,Ae.__proto__={toString:1},Ae).toString==X?(Se=Ae.constructor,K=function(xe){var we=(this.constructor||Se).prototype;return xe in this&&!(xe in we&&this[xe]===we[xe])}):K=function(xe){var we=this.__proto__,De=xe in(this.__proto__=null,this);return this.__proto__=we,De},Ae=null,K.call(this,Ee)}),G=function(Ee,Ae){var Se=0,xe,we,De;for(De in(xe=function(){this.valueOf=0}).prototype.valueOf=0,we=new xe,we)K.call(we,De)&&Se++;return xe=we=null,Se?2==Se?G=function(Ne,Re){var ve={},Pe=X.call(Ne)==ee,Te;for(Te in Ne)!(Pe&&"prototype"==Te)&&!K.call(ve,Te)&&(ve[Te]=1)&&K.call(Ne,Te)&&Re(Te)}:G=function(Ne,Re){var ve=X.call(Ne)==ee,Pe,Te;for(Pe in Ne)ve&&"prototype"==Pe||!K.call(Ne,Pe)||(Te="constructor"===Pe)||Re(Pe);(Te||K.call(Ne,Pe="constructor"))&&Re(Pe)}:(we=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],G=function(Ne,Re){var ve=X.call(Ne)==ee,Oe=!ve&&"function"!=typeof Ne.constructor&&D[typeof Ne.hasOwnProperty]&&Ne.hasOwnProperty||K,Pe,Te;for(Pe in Ne)!(ve&&"prototype"==Pe)&&Oe.call(Ne,Pe)&&Re(Pe);for(Te=we.length;Pe=we[--Te];Oe.call(Ne,Pe)&&Re(Pe));}),G(Ee,Ae)},!q("json-stringify")){var pe={92:"\\\\",34:"\\\"",8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},le=function(Ee,Ae){return("000000"+(Ae||0)).slice(-Ee)},ce=function(Ee){for(var Ae="\"",Se=0,xe=Ee.length,we=!ae||10<xe,De=we&&(ae?Ee.split(""):Ee);Se<xe;Se++){var Ne=Ee.charCodeAt(Se);switch(Ne){case 8:case 9:case 10:case 12:case 13:case 34:case 92:Ae+=pe[Ne];break;default:if(32>Ne){Ae+="\\u00"+le(2,Ne.toString(16));break}Ae+=we?De[Se]:Ee.charAt(Se);}}return Ae+"\""},ue=function(Ee,Ae,Se,xe,we,De,Ne){var Re,ve,Pe,Te,Oe,Be,Ue,Ie,Le,je,qe,Me,Fe,He,ze,Je;try{Re=Ae[Ee]}catch(Ve){}if("object"==typeof Re&&Re)if(ve=X.call(Re),"[object Date]"!=ve||K.call(Re,"toJSON"))"function"==typeof Re.toJSON&&(ve!=te&&ve!=oe&&ve!=ne||K.call(Re,"toJSON"))&&(Re=Re.toJSON(Ee));else if(Re>-1/0&&Re<1/0){if(de){for(Oe=se(Re/86400000),Pe=se(Oe/365.2425)+1970-1;de(Pe+1,0)<=Oe;Pe++);for(Te=se((Oe-de(Pe,0))/30.42);de(Pe,Te+1)<=Oe;Te++);Oe=1+Oe-de(Pe,Te),Be=(Re%86400000+86400000)%86400000,Ue=se(Be/3600000)%24,Ie=se(Be/60000)%60,Le=se(Be/1000)%60,je=Be%1000}else Pe=Re.getUTCFullYear(),Te=Re.getUTCMonth(),Oe=Re.getUTCDate(),Ue=Re.getUTCHours(),Ie=Re.getUTCMinutes(),Le=Re.getUTCSeconds(),je=Re.getUTCMilliseconds();Re=(0>=Pe||10000<=Pe?(0>Pe?"-":"+")+le(6,0>Pe?-Pe:Pe):le(4,Pe))+"-"+le(2,Te+1)+"-"+le(2,Oe)+"T"+le(2,Ue)+":"+le(2,Ie)+":"+le(2,Le)+"."+le(3,je)+"Z"}else Re=null;if(Se&&(Re=Se.call(Ae,Ee,Re)),null===Re)return"null";if(ve=X.call(Re),"[object Boolean]"==ve)return""+Re;if(ve==te)return Re>-1/0&&Re<1/0?""+Re:"null";if(ve==oe)return ce(""+Re);if("object"==typeof Re){for(He=Ne.length;He--;)if(Ne[He]===Re)throw V();if(Ne.push(Re),qe=[],ze=De,De+=we,ve==ne){for(Fe=0,He=Re.length;Fe<He;Fe++)Me=ue(Fe,Re,Se,xe,we,De,Ne),qe.push(Me==$?"null":Me);Je=qe.length?we?"[\n"+De+qe.join(",\n"+De)+"\n"+ze+"]":"["+qe.join(",")+"]":"[]"}else G(xe||Re,function(Ve){var Ye=ue(Ve,Re,Se,xe,we,De,Ne);Ye!==$&&qe.push(ce(Ve)+":"+(we?" ":"")+Ye)}),Je=qe.length?we?"{\n"+De+qe.join(",\n"+De)+"\n"+ze+"}":"{"+qe.join(",")+"}":"{}";return Ne.pop(),Je}};L.stringify=function(Ee,Ae,Se){var xe,we,De,Ne;if(D[typeof Ae]&&Ae)if((Ne=X.call(Ae))==ee)we=Ae;else if(Ne==ne){De={};for(var Re=0,ve=Ae.length,Pe;Re<ve;Pe=Ae[Re++],(Ne=X.call(Pe),Ne==oe||Ne==te)&&(De[Pe]=1));}if(Se)if((Ne=X.call(Se))!=te)Ne==oe&&(xe=10>=Se.length?Se:Se.slice(0,10));else if(0<(Se-=Se%1))for(xe="",10<Se&&(Se=10);xe.length<Se;xe+=" ");return ue("",(Pe={},Pe[""]=Ee,Pe),we,De,xe,"",[])}}if(!q("json-parse")){var he=F.fromCharCode,fe={92:"\\",34:"\"",47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},me=function(){throw ye=ge=null,J()},be=function(){for(var Ee=ge,Ae=Ee.length,Se,xe,we,De,Ne;ye<Ae;)switch(Ne=Ee.charCodeAt(ye),Ne){case 9:case 10:case 13:case 32:ye++;break;case 123:case 125:case 91:case 93:case 58:case 44:return Se=ae?Ee.charAt(ye):Ee[ye],ye++,Se;case 34:for(Se="@",ye++;ye<Ae;)if(Ne=Ee.charCodeAt(ye),32>Ne)me();else if(92==Ne)switch(Ne=Ee.charCodeAt(++ye),Ne){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:Se+=fe[Ne],ye++;break;case 117:for(xe=++ye,we=ye+4;ye<we;ye++)Ne=Ee.charCodeAt(ye),48<=Ne&&57>=Ne||97<=Ne&&102>=Ne||65<=Ne&&70>=Ne||me();Se+=he("0x"+Ee.slice(xe,ye));break;default:me();}else{if(34==Ne)break;for(Ne=Ee.charCodeAt(ye),xe=ye;32<=Ne&&92!=Ne&&34!=Ne;)Ne=Ee.charCodeAt(++ye);Se+=Ee.slice(xe,ye)}if(34==Ee.charCodeAt(ye))return ye++,Se;me();default:if(xe=ye,45==Ne&&(De=!0,Ne=Ee.charCodeAt(++ye)),48<=Ne&&57>=Ne){for(48==Ne&&(Ne=Ee.charCodeAt(ye+1),48<=Ne&&57>=Ne)&&me(),De=!1;ye<Ae&&(Ne=Ee.charCodeAt(ye),48<=Ne&&57>=Ne);ye++);if(46==Ee.charCodeAt(ye)){for(we=++ye;we<Ae&&(Ne=Ee.charCodeAt(we),48<=Ne&&57>=Ne);we++);we==ye&&me(),ye=we}if(Ne=Ee.charCodeAt(ye),101==Ne||69==Ne){for(Ne=Ee.charCodeAt(++ye),(43==Ne||45==Ne)&&ye++,we=ye;we<Ae&&(Ne=Ee.charCodeAt(we),48<=Ne&&57>=Ne);we++);we==ye&&me(),ye=we}return+Ee.slice(xe,ye)}if(De&&me(),"true"==Ee.slice(ye,ye+4))return ye+=4,!0;if("false"==Ee.slice(ye,ye+5))return ye+=5,!1;if("null"==Ee.slice(ye,ye+4))return ye+=4,null;me();}return"$"},_e=function(Ee){var Ae,Se;if("$"==Ee&&me(),"string"==typeof Ee){if("@"==(ae?Ee.charAt(0):Ee[0]))return Ee.slice(1);if("["==Ee){for(Ae=[];;Se||(Se=!0)){if(Ee=be(),"]"==Ee)break;Se&&(","==Ee?(Ee=be(),"]"==Ee&&me()):me()),","==Ee&&me(),Ae.push(_e(Ee))}return Ae}if("{"==Ee){for(Ae={};;Se||(Se=!0)){if(Ee=be(),"}"==Ee)break;Se&&(","==Ee?(Ee=be(),"}"==Ee&&me()):me()),(","==Ee||"string"!=typeof Ee||"@"!=(ae?Ee.charAt(0):Ee[0])||":"!=be())&&me(),Ae[Ee.slice(1)]=_e(be())}return Ae}me()}return Ee},ke=function(Ee,Ae,Se){var xe=Ce(Ee,Ae,Se);xe===$?delete Ee[Ae]:Ee[Ae]=xe},Ce=function(Ee,Ae,Se){var xe=Ee[Ae],we;if("object"==typeof xe&&xe)if(X.call(xe)==ne)for(we=xe.length;we--;)ke(xe,we,Se);else G(xe,function(De){ke(xe,De,Se)});return Se.call(Ee,Ae,xe)},ye,ge;L.parse=function(Ee,Ae){var Se,xe;return ye=0,ge=""+Ee,Se=_e(be()),"$"!=be()&&me(),ye=ge=null,Ae&&X.call(Ae)==ee?Ce((xe={},xe[""]=Se,xe),"",Ae):Se}}}return L.runInContext=S,L}var w="function"==typeof _&&_.amd,D={"function":!0,object:!0},N=D[typeof E]&&E&&!E.nodeType&&E,R=D[typeof window]&&window||this,P=N&&D[typeof C]&&C&&!C.nodeType&&"object"==typeof A&&A;if(P&&(P.global===P||P.window===P||P.self===P)&&(R=P),N&&!w)S(R,N);else{var T=R.JSON,O=R.JSON3,B=!1,U=S(R,R.JSON3={noConflict:function(){return B||(B=!0,R.JSON=T,R.JSON3=O,T=O=null),U}});R.JSON={parse:U.parse,stringify:U.stringify}}w&&_(function(){return U})}).call(this)}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{}],35:[function(k,C,E){function A(O){if(O=""+O,!(10000<O.length)){var B=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(O);if(B){var U=parseFloat(B[1]),I=(B[2]||"ms").toLowerCase();switch(I){case"years":case"year":case"yrs":case"yr":case"y":return U*(365.25*T);case"days":case"day":case"d":return U*T;case"hours":case"hour":case"hrs":case"hr":case"h":return U*P;case"minutes":case"minute":case"mins":case"min":case"m":return U*R;case"seconds":case"second":case"secs":case"sec":case"s":return U*N;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return U;}}}}function S(O){return O>=T?Math.round(O/T)+"d":O>=P?Math.round(O/P)+"h":O>=R?Math.round(O/R)+"m":O>=N?Math.round(O/N)+"s":O+"ms"}function w(O){return D(O,T,"day")||D(O,P,"hour")||D(O,R,"minute")||D(O,N,"second")||O+" ms"}function D(O,B,U){if(!(O<B))return O<1.5*B?Math.floor(O/B)+" "+U:Math.ceil(O/B)+" "+U+"s"}var N=1000,R=60*N,P=60*R,T=24*P;C.exports=function(O,B){return B=B||{},"string"==typeof O?A(O):B.long?w(O):S(O)}},{}],36:[function(k,C,E){(function(A){var S=/^[\],:{}\s]*$/,w=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,D=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,N=/(?:^|:|,)(?:\s*\[)+/g,R=/^\s+/,P=/\s+$/;C.exports=function(O){return"string"==typeof O&&O?(O=O.replace(R,"").replace(P,""),A.JSON&&JSON.parse?JSON.parse(O):S.test(O.replace(w,"@").replace(D,"]").replace(N,""))?new Function("return "+O)():void 0):null}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{}],37:[function(k,C,E){E.encode=function(A){var S="";for(var w in A)A.hasOwnProperty(w)&&(S.length&&(S+="&"),S+=encodeURIComponent(w)+"="+encodeURIComponent(A[w]));return S},E.decode=function(A){var S={},w=A.split("&");for(var D=0,N=w.length;D<N;D++){var R=w[D].split("=");S[decodeURIComponent(R[0])]=decodeURIComponent(R[1])}return S}},{}],38:[function(k,C,E){var A=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,S=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];C.exports=function(D){var N=D,R=D.indexOf("["),P=D.indexOf("]");-1!=R&&-1!=P&&(D=D.substring(0,R)+D.substring(R,P).replace(/:/g,";")+D.substring(P,D.length));for(var T=A.exec(D||""),O={},B=14;B--;)O[S[B]]=T[B]||"";return-1!=R&&-1!=P&&(O.source=N,O.host=O.host.substring(1,O.host.length-1).replace(/;/g,":"),O.authority=O.authority.replace("[","").replace("]","").replace(/;/g,":"),O.ipv6uri=!0),O}},{}],39:[function(k,C,E){(function(A){var S=k("isarray"),w=k("./is-buffer");E.deconstructPacket=function(D){function N(O){if(!O)return O;if(w(O)){var B={_placeholder:!0,num:R.length};return R.push(O),B}if(S(O)){var U=Array(O.length);for(var I=0;I<O.length;I++)U[I]=N(O[I]);return U}if("object"==typeof O&&!(O instanceof Date)){var U={};for(var L in O)U[L]=N(O[L]);return U}return O}var R=[],P=D.data,T=D;return T.data=N(P),T.attachments=R.length,{packet:T,buffers:R}},E.reconstructPacket=function(D,N){function R(P){if(P&&P._placeholder){var T=N[P.num];return T}if(S(P)){for(var O=0;O<P.length;O++)P[O]=R(P[O]);return P}if(P&&"object"==typeof P){for(var B in P)P[B]=R(P[B]);return P}return P}return D.data=R(D.data),D.attachments=void 0,D},E.removeBlobs=function(D,N){function R(O,B,U){if(!O)return O;if(A.Blob&&O instanceof Blob||A.File&&O instanceof File){P++;var I=new FileReader;I.onload=function(){U?U[B]=this.result:T=this.result,--P||N(T)},I.readAsArrayBuffer(O)}else if(S(O))for(var L=0;L<O.length;L++)R(O[L],L,O);else if(O&&"object"==typeof O&&!w(O))for(var q in O)R(O[q],q,O)}var P=0,T=D;R(T),P||N(T)}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{"./is-buffer":41,isarray:33}],40:[function(k,C,E){function A(){}function S(L){var q="",M=!1;return q+=L.type,(E.BINARY_EVENT==L.type||E.BINARY_ACK==L.type)&&(q+=L.attachments,q+="-"),L.nsp&&"/"!=L.nsp&&(M=!0,q+=L.nsp),null!=L.id&&(M&&(q+=",",M=!1),q+=L.id),null!=L.data&&(M&&(q+=","),q+=O.stringify(L.data)),T("encoded %j as %s",L,q),q}function w(L,q){U.removeBlobs(L,function(F){var H=U.deconstructPacket(F),z=S(H.packet),J=H.buffers;J.unshift(z),q(J)})}function D(){this.reconstructor=null}function N(L){var q={},M=0;if(q.type=+L.charAt(0),null==E.types[q.type])return P();if(E.BINARY_EVENT==q.type||E.BINARY_ACK==q.type){for(var F="";"-"!=L.charAt(++M)&&(F+=L.charAt(M),M!=L.length););if(F!=+F||"-"!=L.charAt(M))throw new Error("Illegal attachments");q.attachments=+F}if("/"==L.charAt(M+1))for(q.nsp="";++M;){var H=L.charAt(M);if(","==H)break;if(q.nsp+=H,M==L.length)break}else q.nsp="/";var z=L.charAt(M+1);if(""!==z&&+z==z){for(q.id="";++M;){var H=L.charAt(M);if(null==H||+H!=H){--M;break}if(q.id+=L.charAt(M),M==L.length)break}q.id=+q.id}if(L.charAt(++M))try{q.data=O.parse(L.substr(M))}catch(J){return P()}return T("decoded %s as %j",L,q),q}function R(L){this.reconPack=L,this.buffers=[]}function P(L){return{type:E.ERROR,data:"parser error"}}var T=k("debug")("socket.io-parser"),O=k("json3");k("isarray");var B=k("component-emitter"),U=k("./binary"),I=k("./is-buffer");E.protocol=4,E.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],E.CONNECT=0,E.DISCONNECT=1,E.EVENT=2,E.ACK=3,E.ERROR=4,E.BINARY_EVENT=5,E.BINARY_ACK=6,E.Encoder=A,E.Decoder=D,A.prototype.encode=function(L,q){if(T("encoding packet %j",L),E.BINARY_EVENT==L.type||E.BINARY_ACK==L.type)w(L,q);else{var M=S(L);q([M])}},B(D.prototype),D.prototype.add=function(L){var q;if("string"==typeof L)q=N(L),E.BINARY_EVENT==q.type||E.BINARY_ACK==q.type?(this.reconstructor=new R(q),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",q)):this.emit("decoded",q);else if(!(I(L)||L.base64))throw new Error("Unknown type: "+L);else if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");else q=this.reconstructor.takeBinaryData(L),q&&(this.reconstructor=null,this.emit("decoded",q))},D.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},R.prototype.takeBinaryData=function(L){if(this.buffers.push(L),this.buffers.length==this.reconPack.attachments){var q=U.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),q}return null},R.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":39,"./is-buffer":41,"component-emitter":42,debug:14,isarray:33,json3:34}],41:[function(k,C,E){(function(A){C.exports=function(w){return A.Buffer&&A.Buffer.isBuffer(w)||A.ArrayBuffer&&w instanceof ArrayBuffer}}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{}],42:[function(k,C,E){arguments[4][26][0].apply(E,arguments)},{dup:26}],43:[function(k,C,E){C.exports=function(S,w){var D=[];w=w||0;for(var N=w||0;N<S.length;N++)D[N-w]=S[N];return D}},{}],44:[function(k,C,E){(function(A){;(function(S){function w(V){for(var Y=[],Q=0,W=V.length,X,K;Q<W;)X=V.charCodeAt(Q++),55296<=X&&56319>=X&&Q<W?(K=V.charCodeAt(Q++),56320==(64512&K)?Y.push(((1023&X)<<10)+(1023&K)+65536):(Y.push(X),Q--)):Y.push(X);return Y}function D(V){for(var Y=V.length,Q=-1,X="",W;++Q<Y;)W=V[Q],65535<W&&(W-=65536,X+=L(55296|1023&W>>>10),W=56320|1023&W),X+=L(W);return X}function N(V){if(55296<=V&&57343>=V)throw Error("Lone surrogate U+"+V.toString(16).toUpperCase()+" is not a scalar value")}function R(V,Y){return L(128|63&V>>Y)}function P(V){if(0==(4294967168&V))return L(V);var Y="";return 0==(4294965248&V)?Y=L(192|31&V>>6):0==(4294901760&V)?(N(V),Y=L(224|15&V>>12),Y+=R(V,6)):0==(4292870144&V)&&(Y=L(240|7&V>>18),Y+=R(V,12),Y+=R(V,6)),Y+=L(128|63&V),Y}function T(){if(F>=M)throw Error("Invalid byte index");var V=255&q[F];if(F++,128==(192&V))return 63&V;throw Error("Invalid continuation byte")}function O(){var V,Y,Q,W,X;if(F>M)throw Error("Invalid byte index");if(F==M)return!1;if(V=255&q[F],F++,0==(128&V))return V;if(192==(224&V)){var Y=T();if(X=(31&V)<<6|Y,128<=X)return X;throw Error("Invalid continuation byte")}if(224==(240&V)){if(Y=T(),Q=T(),X=(15&V)<<12|Y<<6|Q,2048<=X)return N(X),X;throw Error("Invalid continuation byte")}if(240==(248&V)&&(Y=T(),Q=T(),W=T(),X=(15&V)<<18|Y<<12|Q<<6|W,65536<=X&&1114111>=X))return X;throw Error("Invalid UTF-8 detected")}var B="object"==typeof E&&E,U="object"==typeof C&&C&&C.exports==B&&C,I="object"==typeof A&&A;(I.global===I||I.window===I)&&(S=I);var L=String.fromCharCode,q,M,F,H={version:"2.0.0",encode:function(Y){for(var Q=w(Y),W=Q.length,X=-1,G="",K;++X<W;)K=Q[X],G+=P(K);return G},decode:function(Y){q=w(Y),M=q.length,F=0;for(var Q=[],W;!1!==(W=O());)Q.push(W);return D(Q)}};if("function"==typeof _&&"object"==typeof _.amd&&_.amd)_(function(){return H});else if(!(B&&!B.nodeType))S.utf8=H;else if(U)U.exports=H;else{var z={}.hasOwnProperty;for(var J in H)z.call(H,J)&&(B[J]=H[J])}})(this)}).call(this,"undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof global?{}:global:window:self)},{}],45:[function(k,C,E){"use strict";function A(O){var B="";do B=w[O%D]+B,O=Math.floor(O/D);while(0<O);return B}function S(){var O=A(+new Date);return O===T?O+"."+A(R++):(R=0,T=O)}for(var w="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),D=64,N={},R=0,P=0,T;P<D;P++)N[w[P]]=P;S.encode=A,S.decode=function(B){var U=0;for(P=0;P<B.length;P++)U=U*D+N[B.charAt(P)];return U},C.exports=S},{}]},{},[1])(1)});var globals={};"undefined"!=typeof window&&(globals.window=window),"undefined"!=typeof document&&(globals.document=document);class core$1{static abstractMethod(){throw Error("Unimplemented abstract method")}static collectSuperClassesProperty(_,k){for(var C=[_[k]];_.__proto__&&!_.__proto__.isPrototypeOf(Function);)_=_.__proto__,C.push(_[k]);return C}static getFunctionName(_){if(!_.name){var k=_.toString();_.name=k.substring(9,k.indexOf("("))}return _.name}static getUid(_,k){if(_){var C=_[core$1.UID_PROPERTY];return k&&!_.hasOwnProperty(core$1.UID_PROPERTY)&&(C=null),C||(_[core$1.UID_PROPERTY]=core$1.uniqueIdCounter_++)}return core$1.uniqueIdCounter_++}static identityFunction(_){return _}static isBoolean(_){return"boolean"==typeof _}static isDef(_){return _!==void 0}static isDefAndNotNull(_){return core$1.isDef(_)&&!core$1.isNull(_)}static isDocument(_){return _&&"object"==typeof _&&9===_.nodeType}static isElement(_){return _&&"object"==typeof _&&1===_.nodeType}static isFunction(_){return"function"==typeof _}static isNull(_){return null===_}static isNumber(_){return"number"==typeof _}static isWindow(_){return null!==_&&_===_.window}static isObject(_){var k=typeof _;return"object"==k&&null!==_||"function"==k}static isPromise(_){return _&&"object"==typeof _&&"function"==typeof _.then}static isString(_){return"string"==typeof _||_ instanceof String}static mergeSuperClassesProperty(_,k,C){var E=k+"_MERGED";if(_.hasOwnProperty(E))return!1;var A=core$1.collectSuperClassesProperty(_,k);return C&&(A=C(A)),_[E]=A,!0}static nullFunction(){}}core$1.UID_PROPERTY="core_"+(1000000000*Math.random()>>>0),core$1.uniqueIdCounter_=1;class array{static equal(_,k){if(_.length!==k.length)return!1;for(var C=0;C<_.length;C++)if(_[C]!==k[C])return!1;return!0}static firstDefinedValue(_){for(var k=0;k<_.length;k++)if(_[k]!==void 0)return _[k]}static flatten(_,k){var C=k||[];for(var E=0;E<_.length;E++)Array.isArray(_[E])?array.flatten(_[E],C):C.push(_[E]);return C}static remove(_,k){var C=_.indexOf(k),E;return(E=0<=C)&&array.removeAt(_,C),E}static removeAt(_,k){return 1===Array.prototype.splice.call(_,k,1).length}static slice(_,k,C){var E=[],A=core$1.isDef(C)?C:_.length;for(var S=k;S<A;S++)E.push(_[S]);return E}}var async={};async.throwException=function(_){async.nextTick(function(){throw _})},async.run=function(_,k){async.run.workQueueScheduled_||(async.nextTick(async.run.processWorkQueue),async.run.workQueueScheduled_=!0),async.run.workQueue_.push(new async.run.WorkItem_(_,k))},async.run.workQueueScheduled_=!1,async.run.workQueue_=[],async.run.processWorkQueue=function(){for(;async.run.workQueue_.length;){var _=async.run.workQueue_;async.run.workQueue_=[];for(var k=0;k<_.length;k++){var C=_[k];try{C.fn.call(C.scope)}catch(E){async.throwException(E)}}}async.run.workQueueScheduled_=!1},async.run.WorkItem_=function(_,k){this.fn=_,this.scope=k},async.nextTick=function(_,k){var C=_;return k&&(C=_.bind(k)),C=async.nextTick.wrapCallback_(C),"function"==typeof setImmediate?void setImmediate(C):void(!async.nextTick.setImmediate_&&(async.nextTick.setImmediate_=async.nextTick.getSetImmediateEmulator_()),async.nextTick.setImmediate_(C))},async.nextTick.setImmediate_=null,async.nextTick.getSetImmediateEmulator_=function(){var _;if("function"==typeof MessageChannel&&(_=MessageChannel),"undefined"==typeof _&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&(_=function(){var A=document.createElement("iframe");A.style.display="none",A.src="",document.documentElement.appendChild(A);var S=A.contentWindow,w=S.document;w.open(),w.write(""),w.close();var D="callImmediate"+Math.random(),N=S.location.protocol+"//"+S.location.host,R=function(P){P.origin!==N&&P.data!==D||this.port1.onmessage()}.bind(this);S.addEventListener("message",R,!1),this.port1={},this.port2={postMessage:function(){S.postMessage(D,N)}}}),"undefined"!=typeof _){var k=new _,C={},E=C;return k.port1.onmessage=function(){C=C.next;var A=C.cb;C.cb=null,A()},function(A){E.next={cb:A},E=E.next,k.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("script")?function(A){var S=document.createElement("script");S.onreadystatechange=function(){S.onreadystatechange=null,S.parentNode.removeChild(S),S=null,A(),A=null},document.documentElement.appendChild(S)}:function(A){setTimeout(A,0)}},async.nextTick.wrapCallback_=function(_){return _};class Disposable{constructor(){this.disposed_=!1}dispose(){this.disposed_||(this.disposeInternal(),this.disposed_=!0)}disposeInternal(){}isDisposed(){return this.disposed_}}class string{static collapseBreakingSpaces(_){return _.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")}static escapeRegex(_){return(_+"").replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}static getRandomString(){var _=2147483648;return Math.floor(Math.random()*_).toString(36)+Math.abs(Math.floor(Math.random()*_)^Date.now()).toString(36)}static hashCode(_){var k=0;for(var C=0,E=_.length;C<E;C++)k=31*k+_.charCodeAt(C),k%=4294967296;return k}static replaceInterval(_,k,C,E){return _.substring(0,k)+E+_.substring(C)}}class Embodied{constructor(){this.body_={}}body(){return this.body_}static toBody(_){return _ instanceof Embodied?_.body():_}toString(){return JSON.stringify(this.body())}}class FilterBody{constructor(_,k,C){var E={operator:core$1.isDef(C)?k:"="},A=core$1.isDef(C)?C:k;core$1.isDefAndNotNull(A)&&(A instanceof Embodied&&(A=A.body()),E.value=A),core$1.isDefAndNotNull(_)?this.createBody_(_,E):this.createBody_("and",[])}add(_,k){k?this.addArrayOperator_(_,k):this.createBody_(_,this.body_)}addArrayOperator_(_,k){this.body_[_]instanceof Array||this.createBody_(_,[this.body_]),this.body_[_].push(k.body())}addMany(_,...k){for(var C=0;C<k.length;C++)this.add(_,k[C])}createBody_(_,k){this.body_={},this.body_[_]=k}getObject(){return this.body_}}class Geo{static boundingBox(_,k){return new Geo.BoundingBox(_,k)}static circle(_,k){return new Geo.Circle(_,k)}static line(..._){return new Geo.Line(..._)}static point(_,k){return new Geo.Point(_,k)}static polygon(..._){return new Geo.Polygon(..._)}}class Point extends Embodied{constructor(_,k){super(),this.body_=[_,k]}}Geo.Point=Point;class Line extends Embodied{constructor(..._){super(),this.body_={type:"linestring",coordinates:_.map(k=>Embodied.toBody(k))}}}Geo.Line=Line;class BoundingBox extends Embodied{constructor(_,k){super(),this.body_={type:"envelope",coordinates:[Embodied.toBody(_),Embodied.toBody(k)]}}getPoints(){return this.body_.coordinates}}Geo.BoundingBox=BoundingBox;class Circle extends Embodied{constructor(_,k){super(),this.body_={type:"circle",coordinates:Embodied.toBody(_),radius:k}}getCenter(){return this.body_.coordinates}getRadius(){return this.body_.radius}}Geo.Circle=Circle;class Polygon extends Embodied{constructor(..._){super(),this.body_={type:"polygon",coordinates:[]},this.addCoordinates_(..._)}addCoordinates_(..._){this.body_.coordinates.push(_.map(k=>Embodied.toBody(k)))}hole(..._){return this.addCoordinates_(..._),this}}Geo.Polygon=Polygon;class Range extends Embodied{constructor(_,k){super(),core$1.isDefAndNotNull(_)&&(this.body_.from=_),core$1.isDefAndNotNull(k)&&(this.body_.to=k)}static from(_){return new Range(_)}static range(_,k){return new Range(_,k)}static to(_){return new Range(null,_)}}class Filter extends Embodied{constructor(_,k,C){super(),this.body_=new FilterBody(_,k,C)}add(_,k,C,E){var A=k?Filter.toFilter(k,C,E):null;return this.body_.add(_,A),this}addMany(_,...k){return this.body_.addMany(_,...k),this}and(_,k,C){return this.add("and",_,k,C)}static any(_){var k=Array.prototype.slice.call(arguments,1);return 1===k.length&&k[0]instanceof Array&&(k=k[0]),new Filter(_,"any",k)}static boundingBox(_,k,C){return k instanceof Geo.BoundingBox?Filter.polygon(_,...k.getPoints()):Filter.polygon(_,k,C)}body(){return this.body_.getObject()}static distance(_,k,C){var E=k,A=C;return k instanceof Geo.Circle?(E=k.getCenter(),A=Range.to(k.getRadius())):!(C instanceof Range)&&(A=Range.to(C)),Filter.distanceInternal_(_,E,A)}static distanceInternal_(_,k,C){var E={location:Embodied.toBody(k)};return C=C.body(),C.from&&(E.min=C.from),C.to&&(E.max=C.to),Filter.field(_,"gd",E)}static equal(_,k){return new Filter(_,"=",k)}static exists(_){return Filter.field(_,"exists",null)}static fuzzy(_,k,C){return Filter.fuzzyInternal_("fuzzy",_,k,C)}static fuzzyInternal_(_,k,C,E){var A=core$1.isString(C),S={query:A?C:k},w=A?E:C;w&&(S.fuzziness=w);var D=A?k:Filter.ALL;return Filter.field(D,_,S)}static gt(_,k){return new Filter(_,">",k)}static gte(_,k){return new Filter(_,">=",k)}static match(_,k){var C=core$1.isString(k)?_:Filter.ALL,E=core$1.isString(k)?k:_;return Filter.field(C,"match",E)}static missing(_){return Filter.field(_,"missing",null)}static phrase(_,k){var C=core$1.isString(k)?_:Filter.ALL,E=core$1.isString(k)?k:_;return Filter.field(C,"phrase",E)}static polygon(_,...k){return k=k.map(C=>Embodied.toBody(C)),Filter.field(_,"gp",k)}static prefix(_,k){var C=k?_:Filter.ALL,E=k?k:_;return Filter.field(C,"prefix",E)}static range(_,k,C){var E=k;return E instanceof Range||(E=Range.range(k,C)),Filter.field(_,"range",E)}static regex(_,k){return new Filter(_,"~",k)}static shape(_,...k){k=k.map(E=>Embodied.toBody(E));var C={type:"geometrycollection",geometries:k};return Filter.field(_,"gs",C)}static similar(_,k){var C=core$1.isString(k)?_:Filter.ALL,E={query:core$1.isString(k)?k:_};return Filter.field(C,"similar",E)}static lt(_,k){return new Filter(_,"<",k)}static lte(_,k){return new Filter(_,"<=",k)}static none(_){var k=Array.prototype.slice.call(arguments,1);return 1===k.length&&k[0]instanceof Array&&(k=k[0]),new Filter(_,"none",k)}static notEqual(_,k){return new Filter(_,"!=",k)}static not(_,k,C){return Filter.toFilter(_,k,C).add("not")}static field(_,k,C){return new Filter(_,k,C)}or(_,k,C){return this.add("or",_,k,C)}static toFilter(_,k,C){var E=_;return E instanceof Filter||(E=Filter.field(_,k,C)),E}}Filter.ALL="*";function parseFromAnchor(_){var k=document.createElement("a");return k.href=_,{hash:k.hash,hostname:k.hostname,password:k.password,pathname:"/"===k.pathname[0]?k.pathname:"/"+k.pathname,port:k.port,protocol:k.protocol,search:k.search,username:k.username}}function parse(_){return core$1.isFunction(URL)&&URL.length?new URL(_):parseFromAnchor(_)}var create=Object.create;class MultiMap extends Disposable{constructor(){super(),this.keys=create(null),this.values=create(null)}add(_,k){return this.keys[_.toLowerCase()]=_,this.values[_.toLowerCase()]=this.values[_.toLowerCase()]||[],this.values[_.toLowerCase()].push(k),this}clear(){return this.keys=create(null),this.values=create(null),this}contains(_){return _.toLowerCase()in this.values}disposeInternal(){this.values=null}static fromObject(_){var k=new MultiMap,C=Object.keys(_);for(var E=0;E<C.length;E++)k.set(C[E],_[C[E]]);return k}get(_){var k=this.values[_.toLowerCase()];if(k)return k[0]}getAll(_){return this.values[_.toLowerCase()]}isEmpty(){return 0===this.size()}names(){return Object.keys(this.values).map(_=>this.keys[_])}remove(_){return delete this.keys[_.toLowerCase()],delete this.values[_.toLowerCase()],this}set(_,k){return this.keys[_.toLowerCase()]=_,this.values[_.toLowerCase()]=[k],this}size(){return this.names().length}toString(){return JSON.stringify(this.values)}}const assertChildHasNoParent=function(_){if(_.getParent())throw new Error("Cannot add child with parent.")};var parseFn_=parse;class Uri{constructor(_=""){this.url=Uri.parse(this.maybeAddProtocolAndHostname_(_))}addParametersFromMultiMap(_){return _.names().forEach(k=>{_.getAll(k).forEach(C=>{this.addParameterValue(k,C)})}),this}addParameterValue(_,k){return this.ensureQueryInitialized_(),core$1.isDef(k)&&(k=k+""),this.query.add(_,k),this}addParameterValues(_,k){return k.forEach(C=>this.addParameterValue(_,C)),this}ensureQueryInitialized_(){if(!this.query){this.query=new MultiMap;var _=this.url.search;_&&_.substring(1).split("&").forEach(k=>{var[C,E]=k.split("=");core$1.isDef(E)&&(E=Uri.urlDecode(E)),this.addParameterValue(C,E)})}}getHash(){return this.url.hash||""}getHost(){var _=this.getHostname();if(_){var k=this.getPort();k&&"80"!==k&&(_+=":"+k)}return _}getHostname(){var _=this.url.hostname;return _===Uri.HOSTNAME_PLACEHOLDER?"":_}getOrigin(){var _=this.getHost();return _?this.getProtocol()+"//"+_:""}getParameterValue(_){return this.ensureQueryInitialized_(),this.query.get(_)}getParameterValues(_){return this.ensureQueryInitialized_(),this.query.getAll(_)}getParameterNames(){return this.ensureQueryInitialized_(),this.query.names()}static getParseFn(){return parseFn_}getPathname(){return this.url.pathname}getPort(){return this.url.port}getProtocol(){return this.url.protocol}getSearch(){var _="",k="";return this.getParameterNames().forEach(C=>{this.getParameterValues(C).forEach(E=>{k+=C,core$1.isDef(E)&&(k+="="+encodeURIComponent(E)),k+="&"})}),k=k.slice(0,-1),k&&(_+="?"+k),_}hasParameter(_){return this.ensureQueryInitialized_(),this.query.contains(_)}makeUnique(){return this.setParameterValue(Uri.RANDOM_PARAM,string.getRandomString()),this}maybeAddProtocolAndHostname_(_){var k=_;if(-1===_.indexOf("://")&&0!==_.indexOf("javascript:"))switch(k=Uri.DEFAULT_PROTOCOL,("/"!==_[0]||"/"!==_[1])&&(k+="//"),_.charAt(0)){case".":case"?":case"#":k+=Uri.HOSTNAME_PLACEHOLDER,k+="/",k+=_;break;case"":case"/":"/"!==_[1]&&(k+=Uri.HOSTNAME_PLACEHOLDER),k+=_;break;default:k+=_;}return k}static normalizeObject(_){var k=_.pathname?_.pathname.length:0;return 1<k&&"/"===_.pathname[k-1]&&(_.pathname=_.pathname.substr(0,k-1)),_}static parse(_){return Uri.normalizeObject(parseFn_(_))}removeParameter(_){return this.ensureQueryInitialized_(),this.query.remove(_),this}removeUnique(){return this.removeParameter(Uri.RANDOM_PARAM),this}setHash(_){return this.url.hash=_,this}setHostname(_){return this.url.hostname=_,this}setParameterValue(_,k){return this.removeParameter(_),this.addParameterValue(_,k),this}setParameterValues(_,k){return this.removeParameter(_),k.forEach(C=>this.addParameterValue(_,C)),this}setPathname(_){return this.url.pathname=_,this}setPort(_){return this.url.port=_,this}static setParseFn(_){parseFn_=_}setProtocol(_){return this.url.protocol=_,":"!==this.url.protocol[this.url.protocol.length-1]&&(this.url.protocol+=":"),this}toString(){var _="",k=this.getHost();return k&&(_+=this.getProtocol()+"//"),_+=k+this.getPathname()+this.getSearch()+this.getHash(),_}static joinPaths(_,...k){return"/"===_.charAt(_.length-1)&&(_=_.substring(0,_.length-1)),k=k.map(C=>"/"===C.charAt(0)?C.substring(1):C),[_].concat(k).join("/").replace(/\/$/,"")}static urlDecode(_){return decodeURIComponent(_.replace(/\+/g," "))}}Uri.DEFAULT_PROTOCOL="http:",Uri.HOSTNAME_PLACEHOLDER="hostname"+Date.now(),Uri.RANDOM_PARAM="zx";function assertBrowserEnvironment(){if(!globals.window)throw new Error("Sign-in type not supported in this environment")}function assertDefAndNotNull(_,k){if(!core$1.isDefAndNotNull(_))throw new Error(k)}function assertFunction(_,k){if(!core$1.isFunction(_))throw new Error(k)}function assertObject(_,k){if(!core$1.isObject(_))throw new Error(k)}function assertResponseSucceeded(_){if(!_.succeeded())throw _.body();return _}function assertUserSignedIn(_){if(!core$1.isDefAndNotNull(_))throw new Error("You must be signed-in to perform this operation")}function assertUriWithNoPath(_,k){var C=new Uri(_);if(1<C.getPathname().length)throw new Error(k)}class Auth{constructor(_,k=null){this.token=core$1.isString(k)?null:_,this.email=core$1.isString(k)?_:null,this.password=k,this.createdAt=null,this.id=null,this.name=null,this.photoUrl=null,this.wedeployClient=null}static create(_,k){return new Auth(_,k)}getCreatedAt(){return this.createdAt}getEmail(){return this.email}getId(){return this.id}getName(){return this.name}getPassword(){return this.password}getPhotoUrl(){return this.photoUrl}getToken(){return this.token}hasCreatedAt(){return core$1.isDefAndNotNull(this.createdAt)}hasEmail(){return core$1.isDefAndNotNull(this.email)}hasId(){return core$1.isDefAndNotNull(this.id)}hasName(){return core$1.isDefAndNotNull(this.name)}hasPassword(){return core$1.isDefAndNotNull(this.password)}hasPhotoUrl(){return core$1.isDefAndNotNull(this.photoUrl)}hasToken(){return core$1.isDefAndNotNull(this.token)}setCreatedAt(_){this.createdAt=_}setEmail(_){this.email=_}setId(_){this.id=_}setName(_){this.name=_}setPassword(_){this.password=_}setPhotoUrl(_){this.photoUrl=_}setToken(_){this.token=_}setWedeployClient(_){this.wedeployClient=_}updateUser(_){return assertObject(_,"User data must be specified as object"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/users").auth(this).patch(_).then(k=>assertResponseSucceeded(k))}deleteUser(){return assertDefAndNotNull(this.id,"Cannot delete user without id"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/users",this.id).auth(this).delete().then(_=>assertResponseSucceeded(_))}}class ApiHelper{constructor(_){assertDefAndNotNull(_,"WeDeploy client reference must be specified"),this.wedeployClient=_}auth(_,k){return this.helperAuthScope=_,this.helperAuthScope instanceof Auth||(this.helperAuthScope=Auth.create(_,k)),this}}class AuthProvider{constructor(){this.provider=null,this.providerScope=null,this.redirectUri=null,this.scope=null}hasProvider(){return core$1.isDefAndNotNull(this.provider)}hasProviderScope(){return core$1.isDefAndNotNull(this.providerScope)}hasRedirectUri(){return core$1.isDefAndNotNull(this.redirectUri)}hasScope(){return core$1.isDefAndNotNull(this.scope)}makeAuthorizationUrl(_){var k=new Uri(_);return k.setPathname("/oauth/authorize"),this.hasProvider()&&k.setParameterValue("provider",this.getProvider()),this.hasProviderScope()&&k.setParameterValue("provider_scope",this.getProviderScope()),this.hasRedirectUri()&&k.setParameterValue("redirect_uri",this.getRedirectUri()),this.hasScope()&&k.setParameterValue("scope",this.getScope()),k.toString()}getProvider(){return this.provider}getProviderScope(){return this.providerScope}getRedirectUri(){return this.redirectUri}getScope(){return this.scope}setProviderScope(_){assertStringIfDefAndNotNull(_,"Provider scope must be a string"),this.providerScope=_}setRedirectUri(_){assertStringIfDefAndNotNull(_,"Redirect uri must be a string"),this.redirectUri=_}setScope(_){assertStringIfDefAndNotNull(_,"Scope must be a string"),this.scope=_}}function assertStringIfDefAndNotNull(_,k){if(core$1.isDefAndNotNull(_)&&!core$1.isString(_))throw new Error(k)}class FacebookAuthProvider extends AuthProvider{constructor(){super(),this.provider=FacebookAuthProvider.PROVIDER}}FacebookAuthProvider.PROVIDER="facebook";class GithubAuthProvider extends AuthProvider{constructor(){super(),this.provider=GithubAuthProvider.PROVIDER}}GithubAuthProvider.PROVIDER="github";class GoogleAuthProvider extends AuthProvider{constructor(){super(),this.provider=GoogleAuthProvider.PROVIDER}}GoogleAuthProvider.PROVIDER="google";class StorageMechanism{clear(){throw Error("Unimplemented abstract method")}set(_,k){throw Error("Unimplemented abstract method")}get(_){throw Error("Unimplemented abstract method")}static isSupported(){return!0}keys(){throw Error("Unimplemented abstract method")}remove(_){throw Error("Unimplemented abstract method")}size(){throw Error("Unimplemented abstract method")}}class Storage{constructor(_){assertMechanismDefAndNotNull(_),assertMechanismIntanceOf(_),this.mechanism=_}clear(){this.mechanism.clear()}set(_,k){return core$1.isDef(k)?void this.mechanism.set(_,JSON.stringify(k)):void this.mechanism.remove(_)}get(_){var k;try{k=this.mechanism.get(_)}catch(C){return void 0}if(core$1.isNull(k))return void 0;try{return JSON.parse(k)}catch(C){throw Storage.ErrorCode.INVALID_VALUE}}keys(){return this.mechanism.keys()}remove(_){this.mechanism.remove(_)}size(){return this.mechanism.size()}values(){return this.keys().map(_=>this.get(_))}}Storage.ErrorCode={INVALID_VALUE:"Storage: Invalid value was encountered"};function assertMechanismDefAndNotNull(_){if(!core$1.isDefAndNotNull(_))throw Error("Storage mechanism is required")}function assertMechanismIntanceOf(_){if(!(_ instanceof StorageMechanism))throw Error("Storage mechanism must me an implementation of StorageMechanism")}class LocalStorageMechanism extends StorageMechanism{storage(){return LocalStorageMechanism.globals.localStorage}clear(){this.storage().clear()}keys(){return Object.keys(this.storage())}get(_){return this.storage().getItem(_)}static isSupported(){return"undefined"!=typeof window}remove(_){this.storage().removeItem(_)}set(_,k){this.storage().setItem(_,k)}size(){return this.storage().length}}LocalStorageMechanism.isSupported()&&(LocalStorageMechanism.globals={localStorage:window.localStorage});class AuthApiHelper extends ApiHelper{constructor(_){super(_),this.currentUser=null,this.onSignInCallback=null,this.onSignOutCallback=null,LocalStorageMechanism.isSupported()&&(this.storage=new Storage(new LocalStorageMechanism())),this.processSignIn_(),this.provider={Facebook:FacebookAuthProvider,Google:GoogleAuthProvider,Github:GithubAuthProvider}}createUser(_){return assertObject(_,"User data must be specified as object"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/users").post(_).then(k=>assertResponseSucceeded(k)).then(k=>this.makeUserAuthFromData(k.body()))}getHrefWithoutFragment_(){var _=globals.window.location;return _.protocol+"//"+_.host+_.pathname+(_.search?_.search:"")}getRedirectAccessToken_(){if(globals.window){var _=globals.window.location.hash;if(0===_.indexOf("#access_token="))return _.substring(14)}return null}getUser(_){return assertDefAndNotNull(_,"User userId must be specified"),assertUserSignedIn(this.currentUser),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/users",_).auth(this.resolveAuthScope().token).get().then(k=>assertResponseSucceeded(k)).then(k=>this.makeUserAuthFromData(k.body()))}loadCurrentUser(_){return assertDefAndNotNull(_,"User token must be specified"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/user").auth(_).get().then(k=>{var C=k.body();return C.token=_,this.currentUser=this.makeUserAuthFromData(C),this.storage&&this.storage.set("currentUser",C),this.currentUser})}makeUserAuthFromData(_){var k=new Auth;return k.setWedeployClient(this.wedeployClient),k.setCreatedAt(_.createdAt),k.setEmail(_.email),k.setId(_.id),k.setName(_.name),k.setPhotoUrl(_.photoUrl),k.setToken(_.token),k}maybeCallOnSignInCallback_(){this.onSignInCallback&&this.onSignInCallback.call(this,this.currentUser)}maybeCallOnSignOutCallback_(){this.onSignOutCallback&&this.onSignOutCallback.call(this,this.currentUser)}onSignIn(_){assertFunction(_,"Sign-in callback must be a function"),this.onSignInCallback=_}onSignOut(_){assertFunction(_,"Sign-out callback must be a function"),this.onSignOutCallback=_}processSignIn_(){var _=this.getRedirectAccessToken_();if(_)return this.removeUrlFragmentCompletely_(),void this.loadCurrentUser(_).then(()=>this.maybeCallOnSignInCallback_());var k=this.storage&&this.storage.get("currentUser");k&&(this.currentUser=this.makeUserAuthFromData(k))}removeUrlFragmentCompletely_(){globals.window.history.pushState({},document.title,window.location.pathname+window.location.search)}resolveAuthScope(){return this.helperAuthScope?this.helperAuthScope:this.currentUser}sendPasswordResetEmail(_){return assertDefAndNotNull(_,"Send password reset email must be specified"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/user/recover").param("email",_).post().then(k=>assertResponseSucceeded(k))}signInWithEmailAndPassword(_,k){return assertDefAndNotNull(_,"Sign-in email must be specified"),assertDefAndNotNull(k,"Sign-in password must be specified"),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/oauth/token").param("grant_type","password").param("username",_).param("password",k).get().then(C=>assertResponseSucceeded(C)).then(C=>this.loadCurrentUser(C.body().access_token)).then(C=>{return this.maybeCallOnSignInCallback_(),C})}signInWithRedirect(_){assertBrowserEnvironment(),assertDefAndNotNull(_,"Sign-in provider must be defined"),assertSupportedProvider(_),_.hasRedirectUri()||_.setRedirectUri(this.getHrefWithoutFragment_()),globals.window.location.href=_.makeAuthorizationUrl(this.wedeployClient.authUrl_)}signOut(){return assertUserSignedIn(this.currentUser),this.wedeployClient.url(this.wedeployClient.authUrl_).path("/oauth/revoke").param("token",this.currentUser.token).get().then(_=>assertResponseSucceeded(_)).then(_=>{return this.maybeCallOnSignOutCallback_(),this.unloadCurrentUser_(),_})}unloadCurrentUser_(){this.currentUser=null,this.storage&&this.storage.remove("currentUser")}}function assertSupportedProvider(_){switch(_.constructor.PROVIDER){case FacebookAuthProvider.PROVIDER:case GithubAuthProvider.PROVIDER:case GoogleAuthProvider.PROVIDER:break;default:throw new Error("Sign-in provider not supported");}}class Aggregation{constructor(_,k,C){this.field_=_,this.operator_=k,this.value_=C}static avg(_){return Aggregation.field(_,"avg")}static count(_){return Aggregation.field(_,"count")}static distance(_,k,...C){return new Aggregation.DistanceAggregation(_,k,...C)}static extendedStats(_){return Aggregation.field(_,"extendedStats")}getField(){return this.field_}getOperator(){return this.operator_}getValue(){return this.value_}static histogram(_,k){return new Aggregation(_,"histogram",k)}static max(_){return Aggregation.field(_,"max")}static min(_){return Aggregation.field(_,"min")}static missing(_){return Aggregation.field(_,"missing")}static field(_,k){return new Aggregation(_,k)}static range(_,...k){return new Aggregation.RangeAggregation(_,...k)}static stats(_){return Aggregation.field(_,"stats")}static sum(_){return Aggregation.field(_,"sum")}static terms(_){return Aggregation.field(_,"terms")}}class DistanceAggregation extends Aggregation{constructor(_,k,...C){super(_,"geoDistance",{}),this.value_.location=Embodied.toBody(k),this.value_.ranges=C.map(E=>E.body())}range(_,k){var C=_;return C instanceof Range||(C=Range.range(_,k)),this.value_.ranges.push(C.body()),this}unit(_){return this.value_.unit=_,this}}Aggregation.DistanceAggregation=DistanceAggregation;class RangeAggregation extends Aggregation{constructor(_,...k){super(_,"range"),this.value_=k.map(C=>C.body())}range(_,k){var C=_;return C instanceof Range||(C=Range.range(_,k)),this.value_.push(C.body()),this}}Aggregation.RangeAggregation=RangeAggregation;class Query extends Embodied{static aggregate(_,k,C){return new Query().aggregate(_,k,C)}static count(){return new Query().type("count")}static fetch(){return new Query().type("fetch")}static filter(_,k,C){return new Query().filter(_,k,C)}static offset(_){return new Query().offset(_)}static highlight(_){return new Query().highlight(_)}static limit(_){return new Query().limit(_)}static search(_,k,C){return new Query().search(_,k,C)}static sort(_,k){return new Query().sort(_,k)}static type(_){return new Query().type(_)}aggregate(_,k,C){var E=k;E instanceof Aggregation||(E=Aggregation.field(k,C));var A=E.getField(),S={};return S[A]={name:_,operator:E.getOperator()},core$1.isDefAndNotNull(E.getValue())&&(S[A].value=E.getValue()),this.body_.aggregation||(this.body_.aggregation=[]),this.body_.aggregation.push(S),this}count(){return this.type("count")}fetch(){return this.type("fetch")}filter(_,k,C){let E=Filter.toFilter(_,k,C);return this.body_.filter||(this.body_.filter=[]),this.body_.filter.push(E.body()),this}offset(_){return this.body_.offset=_,this}highlight(_){return this.body_.highlight||(this.body_.highlight=[]),this.body_.highlight.push(_),this}limit(_){return this.body_.limit=_,this}search(_,k,C){var E=_;return C?E=Filter.field(_,k,C):k?E=Filter.match(_,k):!(E instanceof Filter)&&(E=Filter.match(_)),this.body_.search||(this.body_.search=[]),core$1.isDefAndNotNull(_)?this.body_.search.push(E.body()):this.body_.search.push({}),this}sort(_,k){this.body_.sort||(this.body_.sort=[]);var C={};return C[_]=k||"asc",this.body_.sort.push(C),this}type(_){return this.body_.type=_,this}}class DataApiHelper extends ApiHelper{constructor(_){super(_)}where(_,k,C){return this.getOrCreateFilter_().and(_,k,C),this}or(_,k,C){if(0===this.getOrCreateFilter_().body().and.length)throw Error("It's required to have a condition before using an 'or()' for the first time.");return this.getOrCreateFilter_().or(_,k,C),this}none(_,...k){return this.where(Filter.none(_,k))}match(_,k){return this.where(Filter.match(_,k))}similar(_,k){return this.where(Filter.similar(_,k))}lt(_,k){return this.where(Filter.lt(_,k))}lte(_,k){return this.where(Filter.lte(_,k))}any(_,...k){return this.where(Filter.any(_,k))}boundingBox(_,k,C){return this.where(Filter.boundingBox(_,k,C))}distance(_,k,C){return this.where(Filter.distance(_,k,C))}range(_,k,C){return this.where(Filter.range(_,k,C))}limit(_){return this.getOrCreateQuery_().limit(_),this}offset(_){return this.getOrCreateQuery_().offset(_),this}highlight(_){return this.getOrCreateQuery_().highlight(_),this}aggregate(_,k,C){return this.getOrCreateQuery_().aggregate(_,k,C),this}count(){return this.getOrCreateQuery_().type("count"),this}orderBy(_,k){return this.getOrCreateQuery_().sort(_,k),this}create(_,k){return assertDefAndNotNull(_,"Collection key must be specified."),assertObject(k,"Data can't be empty."),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).post(k).then(C=>assertResponseSucceeded(C)).then(C=>C.body())}update(_,k){return assertDefAndNotNull(_,"Document key must be specified."),assertObject(k,"Data must be specified."),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).put(k).then(C=>assertResponseSucceeded(C)).then(C=>C.body())}delete(_){return assertDefAndNotNull(_,"Document/Field/Collection key must be specified"),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).delete().then(k=>assertResponseSucceeded(k)).then(()=>void 0)}get(_){return assertDefAndNotNull(_,"Document/Field/Collection key must be specified"),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).get(this.query_).then(k=>assertResponseSucceeded(k)).then(k=>k.body())}search(_){return assertDefAndNotNull(_,"Document/Field/Collection key must be specified"),this.onSearch_(),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).get(this.query_).then(k=>assertResponseSucceeded(k)).then(k=>k.body())}watch(_,k){return assertDefAndNotNull(_,"Collection key must be specified"),this.addFiltersToQuery_(),this.wedeployClient.url(this.wedeployClient.dataUrl_).auth(this.helperAuthScope).path(_).watch(this.query_,k)}getOrCreateFilter_(){return this.filter_||(this.filter_=new Filter),this.filter_}getOrCreateQuery_(){return this.query_||(this.query_=new Query),this.query_}addFiltersToQuery_(){return core$1.isDef(this.filter_)&&!0!==this.toSearch_&&this.getOrCreateQuery_().filter(this.filter_),this}onSearch_(){if(core$1.isDef(this.filter_))this.getOrCreateQuery_().search(this.getOrCreateFilter_());else throw Error("It's required to have a condition before using an 'search()' for the first time.");return this.toSearch_=!0,this}}class Base64{static encodeString(_){return"function"==typeof btoa?btoa(_):new Buffer(_.toString(),"binary")}}var Thenable=function(){};Thenable.prototype.then=function(){},Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable",Thenable.addImplementation=function(_){_.prototype.then=_.prototype.then,_.prototype.$goog_Thenable=!0},Thenable.isImplementedBy=function(_){if(!_)return!1;try{return!!_.$goog_Thenable}catch(k){return!1}};var partial=function(_){var k=Array.prototype.slice.call(arguments,1);return function(){var C=k.slice();return C.push.apply(C,arguments),_.apply(this,C)}},CancellablePromise=function(_,k){this.state_=CancellablePromise.State_.PENDING,this.result_=void 0,this.parent_=null,this.callbackEntries_=null,this.executing_=!1,0<CancellablePromise.UNHANDLED_REJECTION_DELAY?this.unhandledRejectionId_=0:0===CancellablePromise.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1);try{var C=this;_.call(k,function(E){C.resolve_(CancellablePromise.State_.FULFILLED,E)},function(E){C.resolve_(CancellablePromise.State_.REJECTED,E)})}catch(E){this.resolve_(CancellablePromise.State_.REJECTED,E)}};CancellablePromise.UNHANDLED_REJECTION_DELAY=0,CancellablePromise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3},CancellablePromise.CallbackEntry_=null,CancellablePromise.resolve=function(_){return new CancellablePromise(function(k){k(_)})},CancellablePromise.reject=function(_){return new CancellablePromise(function(k,C){C(_)})},CancellablePromise.race=function(_){return new CancellablePromise(function(k,C){_.length||k(void 0);for(var E=0,A;A=_[E];E++)A.then(k,C)})},CancellablePromise.all=function(_){return new CancellablePromise(function(k,C){var E=_.length,A=[];if(!E)return void k(A);var S=function(R,P){E--,A[R]=P,0===E&&k(A)},w=function(R){C(R)};for(var D=0,N;N=_[D];D++)N.then(partial(S,D),w)})},CancellablePromise.firstFulfilled=function(_){return new CancellablePromise(function(k,C){var E=_.length,A=[];if(!E)return void k(void 0);var S=function(R){k(R)},w=function(R,P){E--,A[R]=P,0===E&&C(A)};for(var D=0,N;N=_[D];D++)N.then(S,partial(w,D))})},CancellablePromise.prototype.then=function(_,k,C){return this.addChildPromise_(core$1.isFunction(_)?_:null,core$1.isFunction(k)?k:null,C)},Thenable.addImplementation(CancellablePromise),CancellablePromise.prototype.thenAlways=function(_,k){var C=function(){try{_.call(k)}catch(E){CancellablePromise.handleRejection_.call(null,E)}};return this.addCallbackEntry_({child:null,onRejected:C,onFulfilled:C}),this},CancellablePromise.prototype.thenCatch=function(_,k){return this.addChildPromise_(null,_,k)},CancellablePromise.prototype.catch=CancellablePromise.prototype.thenCatch,CancellablePromise.prototype.cancel=function(_){this.state_===CancellablePromise.State_.PENDING&&async.run(function(){var k=new CancellablePromise.CancellationError(_);k.IS_CANCELLATION_ERROR=!0,this.cancelInternal_(k)},this)},CancellablePromise.prototype.cancelInternal_=function(_){this.state_===CancellablePromise.State_.PENDING&&(this.parent_?this.parent_.cancelChild_(this,_):this.resolve_(CancellablePromise.State_.REJECTED,_))},CancellablePromise.prototype.cancelChild_=function(_,k){if(this.callbackEntries_){var C=0,E=-1;for(var A=0,S;S=this.callbackEntries_[A];A++){var w=S.child;if(w&&(C++,w===_&&(E=A),0<=E&&1<C))break}if(0<=E)if(this.state_===CancellablePromise.State_.PENDING&&1==C)this.cancelInternal_(k);else{var D=this.callbackEntries_.splice(E,1)[0];this.executeCallback_(D,CancellablePromise.State_.REJECTED,k)}}},CancellablePromise.prototype.addCallbackEntry_=function(_){this.callbackEntries_&&this.callbackEntries_.length||this.state_!==CancellablePromise.State_.FULFILLED&&this.state_!==CancellablePromise.State_.REJECTED||this.scheduleCallbacks_(),this.callbackEntries_||(this.callbackEntries_=[]),this.callbackEntries_.push(_)},CancellablePromise.prototype.addChildPromise_=function(_,k,C){var E={child:null,onFulfilled:null,onRejected:null};return E.child=new CancellablePromise(function(A,S){E.onFulfilled=_?function(w){try{var D=_.call(C,w);A(D)}catch(N){S(N)}}:A,E.onRejected=k?function(w){try{var D=k.call(C,w);!core$1.isDef(D)&&w.IS_CANCELLATION_ERROR?S(w):A(D)}catch(N){S(N)}}:S}),E.child.parent_=this,this.addCallbackEntry_(E),E.child},CancellablePromise.prototype.unblockAndFulfill_=function(_){if(this.state_!==CancellablePromise.State_.BLOCKED)throw new Error("CancellablePromise is not blocked.");this.state_=CancellablePromise.State_.PENDING,this.resolve_(CancellablePromise.State_.FULFILLED,_)},CancellablePromise.prototype.unblockAndReject_=function(_){if(this.state_!==CancellablePromise.State_.BLOCKED)throw new Error("CancellablePromise is not blocked.");this.state_=CancellablePromise.State_.PENDING,this.resolve_(CancellablePromise.State_.REJECTED,_)},CancellablePromise.prototype.resolve_=function(_,k){if(this.state_===CancellablePromise.State_.PENDING){if(this===k)_=CancellablePromise.State_.REJECTED,k=new TypeError("CancellablePromise cannot resolve to itself");else{if(Thenable.isImplementedBy(k))return k=k,this.state_=CancellablePromise.State_.BLOCKED,void k.then(this.unblockAndFulfill_,this.unblockAndReject_,this);if(core$1.isObject(k))try{var C=k.then;if(core$1.isFunction(C))return void this.tryThen_(k,C)}catch(E){_=CancellablePromise.State_.REJECTED,k=E}}this.result_=k,this.state_=_,this.scheduleCallbacks_(),_!==CancellablePromise.State_.REJECTED||k.IS_CANCELLATION_ERROR||CancellablePromise.addUnhandledRejection_(this,k)}},CancellablePromise.prototype.tryThen_=function(_,k){this.state_=CancellablePromise.State_.BLOCKED;var C=this,E=!1,A=function(w){E||(E=!0,C.unblockAndFulfill_(w))},S=function(w){E||(E=!0,C.unblockAndReject_(w))};try{k.call(_,A,S)}catch(w){S(w)}},CancellablePromise.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,async.run(this.executeCallbacks_,this))},CancellablePromise.prototype.executeCallbacks_=function(){for(;this.callbackEntries_&&this.callbackEntries_.length;){var _=this.callbackEntries_;this.callbackEntries_=[];for(var k=0;k<_.length;k++)this.executeCallback_(_[k],this.state_,this.result_)}this.executing_=!1},CancellablePromise.prototype.executeCallback_=function(_,k,C){k===CancellablePromise.State_.FULFILLED?_.onFulfilled(C):(this.removeUnhandledRejection_(),_.onRejected(C))},CancellablePromise.prototype.removeUnhandledRejection_=function(){var _;if(0<CancellablePromise.UNHANDLED_REJECTION_DELAY)for(_=this;_&&_.unhandledRejectionId_;_=_.parent_)clearTimeout(_.unhandledRejectionId_),_.unhandledRejectionId_=0;else if(0===CancellablePromise.UNHANDLED_REJECTION_DELAY)for(_=this;_&&_.hadUnhandledRejection_;_=_.parent_)_.hadUnhandledRejection_=!1},CancellablePromise.addUnhandledRejection_=function(_,k){0<CancellablePromise.UNHANDLED_REJECTION_DELAY?_.unhandledRejectionId_=setTimeout(function(){CancellablePromise.handleRejection_.call(null,k)},CancellablePromise.UNHANDLED_REJECTION_DELAY):0===CancellablePromise.UNHANDLED_REJECTION_DELAY&&(_.hadUnhandledRejection_=!0,async.run(function(){_.hadUnhandledRejection_&&CancellablePromise.handleRejection_.call(null,k)}))},CancellablePromise.handleRejection_=async.throwException,CancellablePromise.setUnhandledRejectionHandler=function(_){CancellablePromise.handleRejection_=_},CancellablePromise.CancellationError=class extends Error{constructor(_){super(_),_&&(this.message=_)}},CancellablePromise.CancellationError.prototype.name="cancel";class Ajax{static parseResponseHeaders(_){var k=[];if(!_)return k;var C=_.split("\r\n");for(var E=0;E<C.length;E++){var A=C[E].indexOf(": ");if(0<A){var S=C[E].substring(0,A),w=C[E].substring(A+2);k.push({name:S,value:w})}}return k}static request(_,k,C,E,A,S,w,D){_=_||"",k=k||"GET";var N=new XMLHttpRequest,R=new CancellablePromise(function(T,O){N.onload=function(){return N.aborted?void N.onerror():void T(N)},N.onerror=function(){var B=new Error("Request error");B.request=N,O(B)}}).thenCatch(function(T){throw N.abort(),T}).thenAlways(function(){clearTimeout(P)});if(A&&(_=new Uri(_).addParametersFromMultiMap(A).toString()),N.open(k,_,!w),D&&(N.withCredentials=!0),E&&E.names().forEach(function(T){N.setRequestHeader(T,E.getAll(T).join(", "))}),N.send(core$1.isDef(C)?C:null),core$1.isDefAndNotNull(S))var P=setTimeout(function(){R.cancel("Request timeout")},S);return R}}class Transport{send(){}}class ClientMessage{constructor(){this.headers_=new MultiMap}body(_){return core$1.isDef(_)?(this.body_=_,this):this.body_}header(_,k){if(2!==arguments.length)throw new Error("Invalid arguments");return this.headers_.set(_,k),this}headers(_){return core$1.isDef(_)?(_ instanceof MultiMap?this.headers_=_:this.headers_.values=_,_):this.headers_}removeBody(){this.body_=void 0}}class ClientResponse extends ClientMessage{constructor(_){if(super(),!_)throw new Error("Can't create response without request");this.clientRequest_=_}request(){return this.clientRequest_}statusCode(_){return core$1.isDef(_)?(this.statusCode_=_,this):this.statusCode_}statusText(_){return core$1.isDef(_)?(this.statusText_=_,this):this.statusText_}succeeded(){return 200<=this.statusCode()&&399>=this.statusCode()}}class AjaxTransport extends Transport{send(_){var k=Ajax.request(_.url(),_.method(),_.body(),_.headers(),_.params(),null,!1,_.withCredentials());return k.then(function(C){var E=new ClientResponse(_);return E.body(C.responseText),E.statusCode(C.status),E.statusText(C.statusText),Ajax.parseResponseHeaders(C.getAllResponseHeaders()).forEach(function(A){E.header(A.name,A.value)}),E})}}class TransportFactory{constructor(){this.transports={},this.transports[TransportFactory.DEFAULT_TRANSPORT_NAME]=TransportFactory[TransportFactory.DEFAULT_TRANSPORT_NAME]}static instance(){return TransportFactory.instance_||(TransportFactory.instance_=new TransportFactory),TransportFactory.instance_}get(_){var k=this.transports[_];if(!k)throw new Error("Invalid transport name: "+_);try{return new k}catch(C){throw new Error("Can't create transport",C)}}getDefault(){return this.get(TransportFactory.DEFAULT_TRANSPORT_NAME)}}TransportFactory.DEFAULT_TRANSPORT_NAME="default",TransportFactory[TransportFactory.DEFAULT_TRANSPORT_NAME]=AjaxTransport;class ClientRequest extends ClientMessage{constructor(){super(),this.params_=new MultiMap,this.withCredentials_=!0}withCredentials(_){return core$1.isDef(_)?(this.withCredentials_=!!_,this):this.withCredentials_}method(_){return core$1.isDef(_)?(this.method_=_,this):this.method_||ClientRequest.DEFAULT_METHOD}param(_,k){if(2!==arguments.length)throw new Error("Invalid arguments");return this.params_.set(_,k),this}params(_){return core$1.isDef(_)?(_ instanceof MultiMap?this.params_=_:this.params_.values=_,_):this.params_}url(_){return core$1.isDef(_)?(this.url_=_,this):this.url_}}ClientRequest.DEFAULT_METHOD="GET";var io;"undefined"!=typeof globals.window&&(io=globals.window.io);class WeDeploy$1{constructor(_,...k){if(0===arguments.length)throw new Error("Invalid arguments, try `new WeDeploy(baseUrl, url)`");this.auth_=null,this.body_=null,this.url_=Uri.joinPaths(_||"",...k),this.headers_=new MultiMap,this.params_=new MultiMap,this.withCredentials_=!0,this.header("Content-Type","application/json"),this.header("X-Requested-With","XMLHttpRequest")}static data(_){assertUriWithNoPath(_,"The data url should not have a path"),core$1.isString(_)&&(WeDeploy$1.dataUrl_=_);let k=new DataApiHelper(WeDeploy$1);return k.auth(WeDeploy$1.auth().currentUser),k}auth(_,k){return this.auth_=_,this.auth_ instanceof Auth||(this.auth_=Auth.create(_,k)),this}static auth(_){return core$1.isString(_)&&(WeDeploy$1.authUrl_=_),WeDeploy$1.auth_||(WeDeploy$1.auth_=new AuthApiHelper(WeDeploy$1)),WeDeploy$1.auth_}body(_){return this.body_=_,this}convertBodyToParams_(_,k){core$1.isString(k)?k={body:k}:k instanceof Embodied&&(k=k.body()),Object.keys(k||{}).forEach(C=>_.param(C,k[C]))}createClientRequest_(_,k){const C=new ClientRequest;return C.body(k||this.body_),!core$1.isDefAndNotNull(C.body())&&this.formData_&&C.body(this.formData_),C.method(_),C.headers(this.headers()),C.params(this.params()),C.url(this.url()),C.withCredentials(this.withCredentials_),this.encode(C),C}decode(_){if(WeDeploy$1.isContentTypeJson(_))try{_.body(JSON.parse(_.body()))}catch(k){}return _}delete(_){return this.sendAsync("DELETE",_)}encode(_){let k=_.body();return core$1.isElement(k)&&(k=new FormData(k),_.body(k)),k=this.maybeWrapWithQuery_(k),"GET"===_.method()&&(this.convertBodyToParams_(_,k),_.removeBody(),k=null),"undefined"!=typeof FormData&&k instanceof FormData?_.headers().remove("content-type"):k instanceof Embodied?_.body(k.toString()):WeDeploy$1.isContentTypeJson(_)&&_.body(JSON.stringify(_.body())),this.encodeParams_(_),this.resolveAuthentication_(_),_}encodeParams_(_){let k=_.params();k.names().forEach(function(C){let E=k.getAll(C);E.forEach(function(A,S){A instanceof Embodied?A=A.toString():(core$1.isObject(A)||A instanceof Array)&&(A=JSON.stringify(A)),E[S]=A})})}form(_,k){if("undefined"==typeof FormData)throw new Error("form() is only available when FormData API is available.");return this.formData_||(this.formData_=new FormData),this.formData_.append(_,k),this}get(_){return this.sendAsync("GET",_)}header(_,k){if(2!==arguments.length)throw new Error("Invalid arguments");return this.headers_.set(_,k),this}headers(){return this.headers_}maybeWrapWithQuery_(_){return _ instanceof Filter&&(_=Query.filter(_)),_}param(_,k){if(2!==arguments.length)throw new Error("Invalid arguments");return this.params_.set(_,k),this}params(){return this.params_}patch(_){return this.sendAsync("PATCH",_)}path(..._){let k=new WeDeploy$1(this.url(),..._);return core$1.isDefAndNotNull(this.auth_)&&k.auth(this.auth_),k.use(this.customTransport_)}post(_){return this.sendAsync("POST",_)}put(_){return this.sendAsync("PUT",_)}resolveAuthentication_(_){if(this.auth_)if(this.auth_.hasToken())_.header("Authorization","Bearer "+this.auth_.token);else{const k=this.auth_.email+":"+this.auth_.password;_.header("Authorization","Basic "+Base64.encodeString(k))}}sendAsync(_,k){const C=this.customTransport_||TransportFactory.instance().getDefault(),E=this.createClientRequest_(_,k);return C.send(E).then(this.decode)}static socket(_){io=_}static url(_){return new WeDeploy$1(_).use(this.customTransport_)}url(){return this.url_}use(_){return this.customTransport_=_,this}watch(_,k){if("undefined"==typeof io)throw new Error("Socket.io client not loaded");const C=this.createClientRequest_("GET",_),E=new Uri(C.url());return E.addParametersFromMultiMap(C.params()),k=k||{forceNew:!0},k.query="url="+encodeURIComponent(E.getPathname()+E.getSearch()),k.path=k.path||E.getPathname(),io(E.getHost(),k)}withCredentials(_){return this.withCredentials_=!!_,this}}WeDeploy$1.isContentTypeJson=function(_){const k=_.headers().get("content-type")||"";return 0===k.indexOf("application/json")},WeDeploy$1.auth_=null,WeDeploy$1.authUrl_="",WeDeploy$1.data_=null,WeDeploy$1.dataUrl_="",globals.window.Filter=Filter,globals.window.Geo=Geo,globals.window.Query=Query,globals.window.Range=Range,globals.window.WeDeploy=WeDeploy$1;export{Filter,Geo,Query,Range,WeDeploy$1 as WeDeploy};export default WeDeploy$1;